[{"block": 0, "type": "markdown", "linesLength": 1, "startIndex": 0, "lines": ["## Testing transforms.py"]}, {"block": 1, "type": "code", "linesLength": 9, "startIndex": 1, "lines": ["%reload_ext autoreload\n", "%autoreload 2\n", "%matplotlib inline\n", "\n", "# This file contains all the main external libs we'll use\n", "from fastai.imports import *\n", "from fastai.transforms import *\n", "from fastai.plots import *\n", "from fastai.dataset import *"]}, {"block": 2, "type": "code", "linesLength": 2, "startIndex": 10, "lines": ["PATH = \"data/fish/\"\n", "PATH = \"/data2/yinterian/fisheries-kaggle/\""]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 12, "lines": ["### Fish with bounding box"]}, {"block": 4, "type": "code", "linesLength": 1, "startIndex": 13, "lines": ["fnames,corner_labels,_,_ = parse_csv_labels(f'{PATH}trn_bb_corners_labels', skip_header=False)"]}, {"block": 5, "type": "code", "linesLength": 2, "startIndex": 14, "lines": ["def get_x(f):\n", "    return open_image(f'{PATH}/images/{f}')"]}, {"block": 6, "type": "code", "linesLength": 4, "startIndex": 16, "lines": ["f = 'img_02642.jpg'\n", "x = get_x(f)\n", "y = np.array(corner_labels[f], dtype=np.float32)\n", "y"]}, {"block": 7, "type": "code", "linesLength": 1, "startIndex": 20, "lines": ["x.shape"]}, {"block": 8, "type": "code", "linesLength": 2, "startIndex": 21, "lines": ["rows = np.rint([y[0], y[0], y[2], y[2]]).astype(int)\n", "rows"]}, {"block": 9, "type": "code", "linesLength": 2, "startIndex": 23, "lines": ["cols = np.rint([y[1], y[3], y[1], y[3]]).astype(int)\n", "cols"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 25, "lines": ["corner_labels[\"img_02642.jpg\"]"]}, {"block": 11, "type": "code", "linesLength": 9, "startIndex": 26, "lines": ["def create_corner_rect(bb, color='red'):\n", "    bb = np.array(bb, dtype=np.float32)\n", "    return plt.Rectangle((bb[1], bb[0]), bb[3]-bb[1], bb[2]-bb[0], color=color, fill=False, lw=3)\n", "\n", "def show_corner_bb(f='img_04908.jpg'):\n", "    file_path = f'{PATH}images/{f}'\n", "    bb = corner_labels[f]\n", "    plots_from_files([file_path])\n", "    plt.gca().add_patch(create_corner_rect(bb))"]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 35, "lines": ["show_corner_bb(f = 'img_02642.jpg')"]}, {"block": 13, "type": "code", "linesLength": 6, "startIndex": 36, "lines": ["def create_rect(bb, color='red'):\n", "    return plt.Rectangle((bb[1], bb[0]), bb[3]-bb[1], bb[2]-bb[0], color=color, fill=False, lw=3)\n", "\n", "def plotXY(x,y):\n", "    plots([x])\n", "    plt.gca().add_patch(create_rect(y))"]}, {"block": 14, "type": "code", "linesLength": 1, "startIndex": 42, "lines": ["plotXY(x,y)"]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 43, "lines": ["## Scale"]}, {"block": 16, "type": "code", "linesLength": 1, "startIndex": 44, "lines": ["xx, yy = Scale(sz=350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 17, "type": "code", "linesLength": 1, "startIndex": 45, "lines": ["plotXY(xx,yy)"]}, {"block": 18, "type": "code", "linesLength": 2, "startIndex": 46, "lines": ["xx, yy = Scale(sz=350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 19, "type": "markdown", "linesLength": 1, "startIndex": 48, "lines": ["## RandomScale"]}, {"block": 20, "type": "code", "linesLength": 4, "startIndex": 49, "lines": ["xx, yy = RandomScale(sz=350, max_zoom=1.1, tfm_y=TfmType.COORD)(x, y)\n", "plotXY(xx,yy)\n", "print(yy)\n", "print(y)"]}, {"block": 21, "type": "code", "linesLength": 2, "startIndex": 53, "lines": ["xx, yy = RandomScale(sz=350, max_zoom=1.1, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 55, "lines": ["## RandomCrop"]}, {"block": 23, "type": "code", "linesLength": 1, "startIndex": 56, "lines": ["xx, yy = RandomCrop(targ=350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 24, "type": "code", "linesLength": 1, "startIndex": 57, "lines": ["plotXY(xx,yy)"]}, {"block": 25, "type": "code", "linesLength": 2, "startIndex": 58, "lines": ["xx, yy = RandomCrop(350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 26, "type": "markdown", "linesLength": 1, "startIndex": 60, "lines": ["## No Cropping"]}, {"block": 27, "type": "code", "linesLength": 1, "startIndex": 61, "lines": ["xx, yy = NoCrop(350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 28, "type": "code", "linesLength": 2, "startIndex": 62, "lines": ["print(yy)\n", "plotXY(xx,yy)"]}, {"block": 29, "type": "code", "linesLength": 2, "startIndex": 64, "lines": ["xx, yy = NoCrop(350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 30, "type": "markdown", "linesLength": 1, "startIndex": 66, "lines": ["## CenterCrop"]}, {"block": 31, "type": "code", "linesLength": 1, "startIndex": 67, "lines": ["xx, yy = CenterCrop(350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 32, "type": "code", "linesLength": 1, "startIndex": 68, "lines": ["plotXY(xx,yy)"]}, {"block": 33, "type": "code", "linesLength": 2, "startIndex": 69, "lines": ["xx, yy = CenterCrop(350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 34, "type": "markdown", "linesLength": 1, "startIndex": 71, "lines": ["## Random Dihedral"]}, {"block": 35, "type": "code", "linesLength": 1, "startIndex": 72, "lines": ["xx, yy = RandomDihedral(TfmType.COORD)(x, y)"]}, {"block": 36, "type": "code", "linesLength": 1, "startIndex": 73, "lines": ["print(yy)"]}, {"block": 37, "type": "code", "linesLength": 1, "startIndex": 74, "lines": ["plotXY(xx,yy)"]}, {"block": 38, "type": "code", "linesLength": 1, "startIndex": 75, "lines": ["xx, yy = RandomDihedral(tfm_y=TfmType.PIXEL)(x, x)"]}, {"block": 39, "type": "code", "linesLength": 1, "startIndex": 76, "lines": ["plots([xx,yy])"]}, {"block": 40, "type": "markdown", "linesLength": 1, "startIndex": 77, "lines": ["## RandomFlipXY"]}, {"block": 41, "type": "code", "linesLength": 3, "startIndex": 78, "lines": ["xx, yy = RandomFlip(TfmType.COORD)(x, y)\n", "print(yy)\n", "plotXY(xx,yy)"]}, {"block": 42, "type": "code", "linesLength": 2, "startIndex": 81, "lines": ["xx, yy = RandomFlip(TfmType.PIXEL)(x, x)\n", "plots([xx,yy])"]}, {"block": 43, "type": "markdown", "linesLength": 1, "startIndex": 83, "lines": ["## RandomLightingXY (talk to Jeremy about this)"]}, {"block": 44, "type": "code", "linesLength": 2, "startIndex": 84, "lines": ["xx, yy = RandomLighting(0.5, 0.5)(x, y)\n", "plotXY(xx,yy)"]}, {"block": 45, "type": "code", "linesLength": 3, "startIndex": 86, "lines": ["# talk to Jeremy about this\n", "xx, yy = RandomLighting(0.5, 0.5, TfmType.PIXEL)(x, x)\n", "plots([xx,yy])"]}, {"block": 46, "type": "markdown", "linesLength": 1, "startIndex": 89, "lines": ["## RandomRotate"]}, {"block": 47, "type": "code", "linesLength": 3, "startIndex": 90, "lines": ["xx, yy = RandomRotate(deg=30, p=1, tfm_y=TfmType.COORD)(x, y)\n", "plotXY(xx,yy)\n", "print(yy)"]}, {"block": 48, "type": "code", "linesLength": 0, "startIndex": 93, "lines": []}, {"block": 49, "type": "code", "linesLength": 2, "startIndex": 93, "lines": ["xx, yy = RandomRotate(130,p=1.0, tfm_y=TfmType.COORD)(x, y)\n", "plotXY(xx,yy)"]}, {"block": 50, "type": "code", "linesLength": 2, "startIndex": 95, "lines": ["xx, yy = RandomRotate(0.5, 0.5, TfmType.PIXEL)(x, x)\n", "plots([xx,yy])"]}]