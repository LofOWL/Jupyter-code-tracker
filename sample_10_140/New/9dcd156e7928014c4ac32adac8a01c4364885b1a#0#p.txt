[{"block": 0, "type": "code", "linesLength": 3, "startIndex": 0, "lines": ["%reload_ext autoreload\n", "%autoreload 2\n", "%matplotlib inline"]}, {"block": 1, "type": "code", "linesLength": 15, "startIndex": 3, "lines": ["from fastai.imports import *\n", "from fastai.torch_imports import *\n", "from fastai.core import *\n", "\n", "import torchtext\n", "from torchtext import vocab, data\n", "\n", "from torchtext.datasets import language_modeling\n", "\n", "from fastai.rnn_reg import *\n", "from fastai.rnn_train import *\n", "from fastai.nlp import *\n", "from fastai.lm_rnn import *\n", "from fastai.model import fit\n", "from fastai.dataset import *"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 18, "lines": ["## Language modeling"]}, {"block": 3, "type": "code", "linesLength": 2, "startIndex": 19, "lines": ["PATH='data/wikitext-2/'\n", "%ls {PATH}"]}, {"block": 4, "type": "code", "linesLength": 1, "startIndex": 21, "lines": ["!head -5 {PATH}wiki.train.tokens"]}, {"block": 5, "type": "code", "linesLength": 1, "startIndex": 22, "lines": ["!wc -lwc {PATH}wiki.train.tokens"]}, {"block": 6, "type": "code", "linesLength": 1, "startIndex": 23, "lines": ["!wc -lwc {PATH}wiki.valid.tokens"]}, {"block": 7, "type": "code", "linesLength": 6, "startIndex": 24, "lines": ["TEXT = data.Field(lower=True)\n", "FILES = dict(train='wiki.train.tokens', validation='wiki.valid.tokens', test='wiki.test.tokens')\n", "bs = 80\n", "bptt = 70\n", "md = LanguageModelData(PATH, TEXT, **FILES, bs=bs, bptt=bptt, min_freq=10)\n", "len(md.trn_dl), md.nt, len(md.trn_ds), len(md.trn_ds[0].text)"]}, {"block": 8, "type": "code", "linesLength": 1, "startIndex": 30, "lines": ["TEXT.vocab.itos[3875]"]}, {"block": 9, "type": "code", "linesLength": 1, "startIndex": 31, "lines": ["md.trn_ds[0].text[:12]"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 32, "lines": ["TEXT.vocab.itos[98]"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 33, "lines": ["next(md.trn_dl)"]}, {"block": 12, "type": "code", "linesLength": 4, "startIndex": 34, "lines": ["em_sz = 200\n", "nh = 500\n", "nl = 3\n", "learner = md.get_model(SGD_Momentum(0.9), bs, em_sz, nh, nl)"]}, {"block": 13, "type": "code", "linesLength": 1, "startIndex": 38, "lines": ["learner.fit(5, 1, wds=1e-6, stepper_fn=reg_rnn_stepper(), clip=0.25)"]}, {"block": 14, "type": "code", "linesLength": 0, "startIndex": 39, "lines": []}, {"block": 15, "type": "code", "linesLength": 1, "startIndex": 39, "lines": ["learner.fit(5, 6, wds=1e-6, stepper_fn=stepper, cycle_len=1, cycle_mult=2, clip=0.25)"]}, {"block": 16, "type": "code", "linesLength": 1, "startIndex": 40, "lines": ["learner.save('lm_423')"]}, {"block": 17, "type": "code", "linesLength": 1, "startIndex": 41, "lines": ["math.exp(4.23)"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 42, "lines": ["### End"]}, {"block": 19, "type": "code", "linesLength": 0, "startIndex": 43, "lines": []}]