[{"block": 0, "type": "markdown", "linesLength": 1, "startIndex": 0, "lines": ["# Tracking Callbacks"]}, {"block": 1, "type": "code", "linesLength": 4, "startIndex": 1, "lines": ["from fastai.gen_doc.nbdoc import *\n", "from fastai import *\n", "from fastai.vision import *\n", "from fastai.callbacks import *"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 5, "lines": ["This module regroups the callbacks that track one of the metrics computed at the end of each epoch to take some decision about training. To show examples of use, we'll use our sample of MNIST and a simple cnn model."]}, {"block": 3, "type": "code", "linesLength": 2, "startIndex": 6, "lines": ["path = untar_data(URLs.MNIST_SAMPLE)\n", "data = ImageDataBunch.from_folder(path)"]}, {"block": 4, "type": "code", "linesLength": 1, "startIndex": 8, "lines": ["show_doc(callbacks.TerminateOnNaNCallback)"]}, {"block": 5, "type": "markdown", "linesLength": 1, "startIndex": 9, "lines": ["Sometimes, training diverges and the loss goes to nan. In that case, there's no point continuing, so this callback stops the training."]}, {"block": 6, "type": "code", "linesLength": 3, "startIndex": 10, "lines": ["model = simple_cnn((3,16,16,2))\n", "learn = Learner(data, model, metrics=[accuracy])\n", "learn.fit_one_cycle(1,1e4)"]}, {"block": 7, "type": "markdown", "linesLength": 1, "startIndex": 13, "lines": ["Using it prevents that situation to happen."]}, {"block": 8, "type": "code", "linesLength": 3, "startIndex": 14, "lines": ["model = simple_cnn((3,16,16,2))\n", "learn = Learner(data, model, metrics=[accuracy], callbacks=[TerminateOnNaNCallback()])\n", "learn.fit(2,1e4)"]}, {"block": 9, "type": "code", "linesLength": 1, "startIndex": 17, "lines": ["show_doc(EarlyStoppingCallback)"]}, {"block": 10, "type": "markdown", "linesLength": 1, "startIndex": 18, "lines": ["This callback tracks the quantity in `monitor` during the training of `learn`. `mode` can be forced to 'min' or 'max' but will automatically try to determine if the quantity should be the lowest possible (validation loss) or the highest possible (accuracy). Will stop training after `patience` epochs if the quantity hasn't improved by `min_delta`. "]}, {"block": 11, "type": "code", "linesLength": 4, "startIndex": 19, "lines": ["model = simple_cnn((3,16,16,2))\n", "learn = Learner(data, model, metrics=[accuracy], \n", "                callback_fns=[partial(EarlyStoppingCallback, monitor='accuracy', min_delta=0.01, patience=3)])\n", "learn.fit(50,1e-42)"]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 23, "lines": ["show_doc(SaveModelCallback)"]}, {"block": 13, "type": "markdown", "linesLength": 1, "startIndex": 24, "lines": ["This callback tracks the quantity in `monitor` during the training of `learn`. `mode` can be forced to 'min' or 'max' but will automatically try to determine if the quantity should be the lowest possible (validation loss) or the highest possible (accuracy). Will save the model in `name` whenever determined by `every` ('improvement' or 'epoch'). Loads the best model at the end of training is `every='improvement'`."]}, {"block": 14, "type": "code", "linesLength": 1, "startIndex": 25, "lines": ["show_doc(ReduceLROnPlateauCallback)"]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 26, "lines": ["This callback tracks the quantity in `monitor` during the training of `learn`. `mode` can be forced to 'min' or 'max' but will automatically try to determine if the quantity should be the lowest possible (validation loss) or the highest possible (accuracy). Will reduce the learning rate by `factor` after `patience` epochs if the quantity hasn't improved by `min_delta`. "]}, {"block": 16, "type": "code", "linesLength": 1, "startIndex": 27, "lines": ["show_doc(TrackerCallback)"]}, {"block": 17, "type": "code", "linesLength": 1, "startIndex": 28, "lines": ["show_doc(TerminateOnNaNCallback)"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 29, "lines": ["## Undocumented Methods - Methods moved below this line will intentionally be hidden"]}, {"block": 19, "type": "markdown", "linesLength": 1, "startIndex": 30, "lines": ["## New Methods - Please document or move to the undocumented section"]}, {"block": 20, "type": "code", "linesLength": 1, "startIndex": 31, "lines": ["show_doc(SaveModelCallback.on_epoch_end)"]}, {"block": 21, "type": "markdown", "linesLength": 0, "startIndex": 32, "lines": []}, {"block": 22, "type": "code", "linesLength": 1, "startIndex": 32, "lines": ["show_doc(TerminateOnNaNCallback.on_batch_end)"]}, {"block": 23, "type": "markdown", "linesLength": 0, "startIndex": 33, "lines": []}, {"block": 24, "type": "code", "linesLength": 1, "startIndex": 33, "lines": ["show_doc(EarlyStoppingCallback.on_train_begin)"]}, {"block": 25, "type": "markdown", "linesLength": 0, "startIndex": 34, "lines": []}, {"block": 26, "type": "code", "linesLength": 1, "startIndex": 34, "lines": ["show_doc(SaveModelCallback.on_train_end)"]}, {"block": 27, "type": "markdown", "linesLength": 0, "startIndex": 35, "lines": []}, {"block": 28, "type": "code", "linesLength": 1, "startIndex": 35, "lines": ["show_doc(ReduceLROnPlateauCallback.on_epoch_end)"]}, {"block": 29, "type": "markdown", "linesLength": 0, "startIndex": 36, "lines": []}, {"block": 30, "type": "code", "linesLength": 1, "startIndex": 36, "lines": ["show_doc(EarlyStoppingCallback.on_epoch_end)"]}, {"block": 31, "type": "markdown", "linesLength": 0, "startIndex": 37, "lines": []}, {"block": 32, "type": "code", "linesLength": 1, "startIndex": 37, "lines": ["show_doc(TerminateOnNaNCallback.on_epoch_end)"]}, {"block": 33, "type": "markdown", "linesLength": 0, "startIndex": 38, "lines": []}, {"block": 34, "type": "code", "linesLength": 1, "startIndex": 38, "lines": ["show_doc(TrackerCallback.on_train_begin)"]}, {"block": 35, "type": "markdown", "linesLength": 0, "startIndex": 39, "lines": []}, {"block": 36, "type": "code", "linesLength": 1, "startIndex": 39, "lines": ["show_doc(ReduceLROnPlateauCallback.on_train_begin)"]}, {"block": 37, "type": "markdown", "linesLength": 0, "startIndex": 40, "lines": []}, {"block": 38, "type": "code", "linesLength": 1, "startIndex": 40, "lines": ["show_doc(TrackerCallback.get_monitor_value)"]}, {"block": 39, "type": "markdown", "linesLength": 0, "startIndex": 41, "lines": []}]