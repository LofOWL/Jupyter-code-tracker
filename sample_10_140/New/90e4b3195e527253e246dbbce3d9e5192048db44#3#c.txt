[{"block": 0, "type": "markdown", "linesLength": 7, "startIndex": 0, "lines": ["## ThinkDSP\n", "\n", "This notebook contains code examples from Chapter 2: Harmonics\n", "\n", "Copyright 2015 Allen Downey\n", "\n", "License: [Creative Commons Attribution 4.0 International](http://creativecommons.org/licenses/by/4.0/)"]}, {"block": 1, "type": "code", "linesLength": 10, "startIndex": 7, "lines": ["from __future__ import print_function, division\n", "\n", "%matplotlib inline\n", "\n", "import thinkdsp\n", "import thinkplot\n", "\n", "from ipywidgets import interact, interactive, fixed\n", "import ipywidgets as widgets\n", "from IPython.display import display"]}, {"block": 2, "type": "markdown", "linesLength": 3, "startIndex": 17, "lines": ["## Waveforms and harmonics\n", "\n", "Create a triangle signal and plot a 3 period segment."]}, {"block": 3, "type": "code", "linesLength": 4, "startIndex": 20, "lines": ["signal = thinkdsp.TriangleSignal(200)\n", "duration = signal.period*3\n", "segment = signal.make_wave(duration, framerate=10000)\n", "segment.plot()"]}, {"block": 4, "type": "markdown", "linesLength": 1, "startIndex": 24, "lines": ["Make a wave and play it."]}, {"block": 5, "type": "code", "linesLength": 3, "startIndex": 25, "lines": ["wave = signal.make_wave(duration=0.5, framerate=10000)\n", "wave.apodize()\n", "wave.make_audio()"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 28, "lines": ["Compute its spectrum and plot it."]}, {"block": 7, "type": "code", "linesLength": 2, "startIndex": 29, "lines": ["spectrum = wave.make_spectrum()\n", "spectrum.plot()"]}, {"block": 8, "type": "markdown", "linesLength": 1, "startIndex": 31, "lines": ["Make a square signal and plot a 3 period segment."]}, {"block": 9, "type": "code", "linesLength": 5, "startIndex": 32, "lines": ["signal = thinkdsp.SquareSignal(200)\n", "duration = signal.period*3\n", "segment = signal.make_wave(duration, framerate=10000)\n", "segment.plot()\n", "thinkplot.config(ylim=[-1.05, 1.05], legend=False)"]}, {"block": 10, "type": "markdown", "linesLength": 1, "startIndex": 37, "lines": ["Make a wave and play it."]}, {"block": 11, "type": "code", "linesLength": 3, "startIndex": 38, "lines": ["wave = signal.make_wave(duration=0.5, framerate=10000)\n", "wave.apodize()\n", "wave.make_audio()"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 41, "lines": ["Compute its spectrum and plot it."]}, {"block": 13, "type": "code", "linesLength": 2, "startIndex": 42, "lines": ["spectrum = wave.make_spectrum()\n", "spectrum.plot()"]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 44, "lines": ["Create a sawtooth signal and plot a 3 period segment."]}, {"block": 15, "type": "code", "linesLength": 4, "startIndex": 45, "lines": ["signal = thinkdsp.SawtoothSignal(200)\n", "duration = signal.period*3\n", "segment = signal.make_wave(duration, framerate=10000)\n", "segment.plot()"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 49, "lines": ["Make a wave and play it."]}, {"block": 17, "type": "code", "linesLength": 3, "startIndex": 50, "lines": ["wave = signal.make_wave(duration=0.5, framerate=10000)\n", "wave.apodize()\n", "wave.make_audio()"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 53, "lines": ["Compute its spectrum and plot it."]}, {"block": 19, "type": "code", "linesLength": 2, "startIndex": 54, "lines": ["spectrum = wave.make_spectrum()\n", "spectrum.plot()"]}, {"block": 20, "type": "markdown", "linesLength": 3, "startIndex": 56, "lines": ["### Aliasing\n", "\n", "Make a cosine signal at 4500 Hz, make a wave at framerate 10 kHz, and plot 5 periods."]}, {"block": 21, "type": "code", "linesLength": 6, "startIndex": 59, "lines": ["framerate = 10000\n", "\n", "signal = thinkdsp.CosSignal(4500)\n", "duration = signal.period*5\n", "segment = signal.make_wave(duration, framerate=framerate)\n", "segment.plot()"]}, {"block": 22, "type": "markdown", "linesLength": 3, "startIndex": 65, "lines": ["Make a cosine signal at 5500 Hz, make a wave at framerate 10 kHz, and plot the same duration.\n", "\n", "With framerate 10 kHz, the folding frequency is 5 kHz, so a 4500 Hz signal and a 5500 Hz signal look exactly the same."]}, {"block": 23, "type": "code", "linesLength": 3, "startIndex": 68, "lines": ["signal = thinkdsp.CosSignal(5500)\n", "segment = signal.make_wave(duration, framerate=framerate)\n", "segment.plot()"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 71, "lines": ["Make a triangle signal and plot the spectrum.  See how the harmonics get folded."]}, {"block": 25, "type": "code", "linesLength": 4, "startIndex": 72, "lines": ["signal = thinkdsp.TriangleSignal(1100)\n", "segment = signal.make_wave(duration=0.5, framerate=10000)\n", "spectrum = segment.make_spectrum()\n", "spectrum.plot()"]}, {"block": 26, "type": "markdown", "linesLength": 3, "startIndex": 76, "lines": ["## Amplitude and phase\n", "\n", "Make a triangle wave."]}, {"block": 27, "type": "code", "linesLength": 4, "startIndex": 79, "lines": ["signal = thinkdsp.SawtoothSignal(500)\n", "wave = signal.make_wave(duration=1, framerate=10000)\n", "segment = wave.segment(duration=0.005)\n", "segment.plot()"]}, {"block": 28, "type": "markdown", "linesLength": 1, "startIndex": 83, "lines": ["Play it."]}, {"block": 29, "type": "code", "linesLength": 1, "startIndex": 84, "lines": ["wave.make_audio()"]}, {"block": 30, "type": "markdown", "linesLength": 1, "startIndex": 85, "lines": ["Extract the wave array and compute the real FFT (which is just an FFT optimized for real inputs)."]}, {"block": 31, "type": "code", "linesLength": 4, "startIndex": 86, "lines": ["import numpy as np\n", "\n", "hs = np.fft.rfft(wave.ys)\n", "hs"]}, {"block": 32, "type": "markdown", "linesLength": 1, "startIndex": 90, "lines": ["Compute the frequencies that match up with the elements of the FFT."]}, {"block": 33, "type": "code", "linesLength": 4, "startIndex": 91, "lines": ["n = len(wave.ys)                 # number of samples\n", "d = 1 / wave.framerate           # time between samples\n", "fs = np.fft.rfftfreq(n, d)\n", "fs"]}, {"block": 34, "type": "markdown", "linesLength": 1, "startIndex": 95, "lines": ["Plot the magnitudes vs the frequencies."]}, {"block": 35, "type": "code", "linesLength": 2, "startIndex": 96, "lines": ["magnitude = np.absolute(hs)\n", "thinkplot.plot(fs, magnitude)"]}, {"block": 36, "type": "markdown", "linesLength": 1, "startIndex": 98, "lines": ["Plot the phases vs the frequencies."]}, {"block": 37, "type": "code", "linesLength": 2, "startIndex": 99, "lines": ["angle = np.angle(hs)\n", "thinkplot.plot(fs, angle)"]}, {"block": 38, "type": "markdown", "linesLength": 3, "startIndex": 101, "lines": ["## What does phase sound like?\n", "\n", "Shuffle the phases."]}, {"block": 39, "type": "code", "linesLength": 3, "startIndex": 104, "lines": ["import random\n", "random.shuffle(angle)\n", "thinkplot.plot(fs, angle)"]}, {"block": 40, "type": "markdown", "linesLength": 1, "startIndex": 107, "lines": ["Put the shuffled phases back into the spectrum.  Each element in `hs` is a complex number with magitude $A$ and phase $\\phi$, we we compute $A e^{i \\phi}$"]}, {"block": 41, "type": "code", "linesLength": 2, "startIndex": 108, "lines": ["i = complex(0, 1)\n", "spectrum.hs = magnitude * np.exp(i * angle)"]}, {"block": 42, "type": "markdown", "linesLength": 1, "startIndex": 110, "lines": ["Convert the spectrum back to a wave (which uses irfft)."]}, {"block": 43, "type": "code", "linesLength": 3, "startIndex": 111, "lines": ["wave2 = spectrum.make_wave()\n", "segment = wave2.segment(duration=0.005)\n", "segment.plot()"]}, {"block": 44, "type": "markdown", "linesLength": 1, "startIndex": 114, "lines": ["Play the wave with the shuffled phases."]}, {"block": 45, "type": "code", "linesLength": 1, "startIndex": 115, "lines": ["wave2.make_audio()"]}, {"block": 46, "type": "markdown", "linesLength": 1, "startIndex": 116, "lines": ["For comparison, here's the original wave again."]}, {"block": 47, "type": "code", "linesLength": 1, "startIndex": 117, "lines": ["wave.make_audio()"]}, {"block": 48, "type": "markdown", "linesLength": 1, "startIndex": 118, "lines": ["Although the two signals have different waveforms, they have the same frequency components with the same amplitudes.  They differ only in phase."]}, {"block": 49, "type": "markdown", "linesLength": 3, "startIndex": 119, "lines": ["## Aliasing interaction\n", "\n", "The following interaction explores the effect of aliasing on the harmonics of a sawtooth signal."]}, {"block": 50, "type": "code", "linesLength": 8, "startIndex": 122, "lines": ["def view_harmonics(freq, framerate):\n", "    signal = thinkdsp.SawtoothSignal(freq)\n", "    wave = signal.make_wave(duration=0.5, framerate=framerate)\n", "    spectrum = wave.make_spectrum()\n", "    spectrum.plot(color='blue')\n", "    thinkplot.config(xlabel='frequency', ylabel='amplitude')\n", "    \n", "    display(wave.make_audio())"]}, {"block": 51, "type": "code", "linesLength": 6, "startIndex": 130, "lines": ["from ipywidgets import interact, interactive, fixed\n", "import ipywidgets as widgets\n", "\n", "slider1 = widgets.FloatSlider(min=100, max=10000, value=100, step=100)\n", "slider2 = widgets.FloatSlider(min=5000, max=40000, value=10000, step=1000)\n", "interact(view_harmonics, freq=slider1, framerate=slider2);"]}, {"block": 52, "type": "code", "linesLength": 0, "startIndex": 136, "lines": []}, {"block": 53, "type": "code", "linesLength": 0, "startIndex": 136, "lines": []}]