[{"block": 0, "type": "markdown", "linesLength": 3, "startIndex": 0, "lines": ["# Introduction: Interacting with Slack from Python\n", "\n", "In this notebook, we will use `Slacker` to interact with Slack. This allows us to send messages and upload files, which can be useful when training models, or monitoring scripts (or just for fun of course)!"]}, {"block": 1, "type": "code", "linesLength": 1, "startIndex": 3, "lines": ["!pip install -q -U Slacker"]}, {"block": 2, "type": "code", "linesLength": 11, "startIndex": 4, "lines": ["import numpy as np\n", "import pandas as pd\n", "\n", "# Slacker \n", "from slacker import Slacker\n", "\n", "# Plotting\n", "import matplotlib.pyplot as plt\n", "import seaborn as sns\n", "%matplotlib inline\n", "plt.style.use('fivethirtyeight')"]}, {"block": 3, "type": "markdown", "linesLength": 5, "startIndex": 15, "lines": ["# Get a Slack Legacy API Token\n", "\n", "https://api.slack.com/custom-integrations/legacy-tokens\n", "\n", "Store in a safe location (not on GitHub)!"]}, {"block": 4, "type": "markdown", "linesLength": 3, "startIndex": 20, "lines": ["## Authenticate with Slack\n", "\n", "Read in slack api token. Replace the line below with the location of your slack api token."]}, {"block": 5, "type": "code", "linesLength": 2, "startIndex": 23, "lines": ["with open('C:/Users/willk/OneDrive/Desktop/slack_api_python.txt', 'r') as f:\n", "    slack_api_token = f.read()"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 25, "lines": ["Authenticate with slack and print out channels to make sure everything worked."]}, {"block": 7, "type": "code", "linesLength": 6, "startIndex": 26, "lines": ["# Connect to Slack\n", "slack = Slacker(slack_api_token)\n", "channels = slack.channels.list()\n", "\n", "for channel in channels.body['channels']:\n", "    print(f'Channel {channel[\"name\"]} Purpose: {channel[\"purpose\"][\"value\"]} ID: {channel[\"id\"]}\\n')"]}, {"block": 8, "type": "markdown", "linesLength": 3, "startIndex": 32, "lines": ["# Options\n", "\n", "Anything you can do in Slack itself, you can do with `Slacker`. Let's take a look at the options."]}, {"block": 9, "type": "code", "linesLength": 23, "startIndex": 35, "lines": ["from pprint import pprint\n", "\n", "command_dict = {'functions': {},\n", "                'attributes': {}}\n", "\n", "# Modules\n", "for d in dir(slack):\n", "    if not d.startswith('_'):\n", "        command_dict['functions'][d] = []\n", "        command_dict['attributes'][d] = []\n", "        # Iterate through methods and attributes\n", "        for dd in dir(getattr(slack, d)):\n", "            if not dd.startswith('_'):\n", "                # List of methods and attributes\n", "                l = dir(getattr(getattr(slack, d), dd))\n", "                # Method (function)\n", "                if '__call__' in l:\n", "                    command_dict['functions'][d].append(dd)\n", "                # Attributes\n", "                else:\n", "                    command_dict['attributes'][d].append(dd)\n", "                    \n", "pprint(command_dict['functions']['users'])"]}, {"block": 10, "type": "markdown", "linesLength": 1, "startIndex": 58, "lines": ["Let's see how to use one of these. Here we'll list the users and some information."]}, {"block": 11, "type": "code", "linesLength": 3, "startIndex": 59, "lines": ["r = slack.users.list()\n", "for member in r.body['members']:\n", "    print(f\"Real name: {member['real_name']:12} Time Zone: {member['tz']} Status: {member['profile']['status_text']}\")"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 62, "lines": ["`r` is a response object. For each method, there will be different pieces of information you can retrieve."]}, {"block": 13, "type": "code", "linesLength": 5, "startIndex": 63, "lines": ["from IPython.display import Image\n", "\n", "r = slack.users.list()\n", "img_url = r.body['members'][0]['profile']['image_original']\n", "Image(url=img_url, embed=True)"]}, {"block": 14, "type": "code", "linesLength": 1, "startIndex": 68, "lines": ["r.body['members'][0]['profile']['title']"]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 69, "lines": ["Of course, we can change this title if we are happy with it! "]}, {"block": 16, "type": "code", "linesLength": 5, "startIndex": 70, "lines": ["users = slack.users\n", "r = users.profile.set(user=users.get_user_id('wjk68'), \n", "                      name='title', \n", "                      value = 'Data Scientist and Writer')\n", "r.successful"]}, {"block": 17, "type": "code", "linesLength": 2, "startIndex": 75, "lines": ["r = slack.users.list()\n", "r.body['members'][0]['profile']['title']"]}, {"block": 18, "type": "markdown", "linesLength": 3, "startIndex": 77, "lines": ["# Posting Messages\n", "\n", "We can post messages very simply."]}, {"block": 19, "type": "code", "linesLength": 5, "startIndex": 80, "lines": ["r = slack.chat.post_message(channel = 'python_content', \n", "                            text = 'Have a great day!',\n", "                            username = 'Python Test',\n", "                            icon_url = 'http://devarea.com/wp-content/uploads/2017/11/python-300x300.png')\n", "r.successful"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 85, "lines": ["![](images/posted_message.PNG)"]}, {"block": 21, "type": "markdown", "linesLength": 1, "startIndex": 86, "lines": ["We can also post as ourselves."]}, {"block": 22, "type": "code", "linesLength": 4, "startIndex": 87, "lines": ["r = slack.chat.post_message(channel = 'python_content', \n", "                            text = 'Anyone up for a trip to the store?',\n", "                            as_user = 'willk')\n", "r.successful"]}, {"block": 23, "type": "markdown", "linesLength": 1, "startIndex": 91, "lines": ["![](images/my_posted_message.PNG)"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 92, "lines": ["We can also upload files."]}, {"block": 25, "type": "code", "linesLength": 4, "startIndex": 93, "lines": ["r = slack.files.upload(file_ = 'images/volcano_crater.jpg',\n", "                   channels= ['random'], title = 'Volcano Crater',\n", "                   initial_comment = 'This would make a great display background')\n", "r.successful"]}, {"block": 26, "type": "code", "linesLength": 2, "startIndex": 97, "lines": ["img_url = r.body['file']['thumb_480']\n", "img_url"]}, {"block": 27, "type": "code", "linesLength": 1, "startIndex": 99, "lines": ["Image(url=img_url)"]}, {"block": 28, "type": "markdown", "linesLength": 1, "startIndex": 100, "lines": ["# Creating a New Channel"]}, {"block": 29, "type": "code", "linesLength": 4, "startIndex": 101, "lines": ["slack.channels.create('python_content3')\n", "new_id = slack.channels.get_channel_id('python_content3')\n", "r = slack.channels.history(new_id)\n", "r.body"]}, {"block": 30, "type": "code", "linesLength": 2, "startIndex": 105, "lines": ["r = slack.channels.history(slack.channels.get_channel_id('random'))\n", "r.body['messages'][0]"]}, {"block": 31, "type": "code", "linesLength": 9, "startIndex": 107, "lines": ["slack.channels.set_purpose(slack.channels.get_channel_id('random'), \n", "                           'Deep philosophical discussions around the water cooler.')\n", "slack.channels.set_purpose(slack.channels.get_channel_id('python_content3'), \n", "                           'Sharing great python related resources')\n", "\n", "channels = slack.channels.list()\n", "\n", "for channel in channels.body['channels']:\n", "    print(f'Channel {channel[\"name\"]} Purpose: {channel[\"purpose\"][\"value\"]}\\n')"]}, {"block": 32, "type": "code", "linesLength": 5, "startIndex": 116, "lines": ["from PIL import Image\n", "import requests\n", "url = user['profile']['image_192']\n", "im = Image.open(requests.get(url, stream=True).raw)\n", "plt.imshow(im)"]}, {"block": 33, "type": "code", "linesLength": 1, "startIndex": 121, "lines": ["PIL.Image.from"]}, {"block": 34, "type": "code", "linesLength": 1, "startIndex": 122, "lines": ["user['profile']['image_192']"]}, {"block": 35, "type": "code", "linesLength": 3, "startIndex": 123, "lines": ["from IPython.display import Image\n", "from IPython.core.interactiveshell import InteractiveShell\n", "InteractiveShell.ast_node_interactivity = 'all'"]}, {"block": 36, "type": "code", "linesLength": 10, "startIndex": 126, "lines": ["from IPython.display import Image\n", "\n", "users = slack.users.list()\n", "\n", "for user in users.body['members']:\n", "    # Print some information\n", "    print(f'\\nUser: {user[\"name\"]}, Real Name: {user[\"real_name\"]}, Time Zone: {user[\"tz_label\"]}.')\n", "    print(f'Current Status: {user[\"profile\"][\"status_text\"]}')\n", "    # Get image data and show\n", "    Image(user['profile']['image_192'])"]}, {"block": 37, "type": "code", "linesLength": 1, "startIndex": 136, "lines": ["slack.files.upload('first_plot.png', channels = ['testing_exp', 'slack_interaction']);"]}, {"block": 38, "type": "code", "linesLength": 0, "startIndex": 137, "lines": []}]