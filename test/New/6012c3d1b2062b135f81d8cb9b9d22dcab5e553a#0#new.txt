[{"block": 0, "type": "code", "linesLength": 5, "startIndex": 0, "lines": ["import pandas as pd\n", "import numpy as np\n", "\n", "import matplotlib.pyplot as plt\n", "%matplotlib inline"]}, {"block": 1, "type": "markdown", "linesLength": 3, "startIndex": 5, "lines": ["# Restaurant Reviews\n", "\n", "This is a simplified fictional example showing Simpson's Paradox: trends that are present when looking at a segmented version of the data can be reversed when aggregating the data. "]}, {"block": 2, "type": "code", "linesLength": 4, "startIndex": 8, "lines": ["data = pd.DataFrame({'A Ratings': [6.5, 8.5], 'B Ratings': [8, 9], \n", "                     'A Number': [10, 300], 'B Number': [180, 40], \n", "                     'Gender': ['M', 'F']}).set_index('Gender')\n", "data"]}, {"block": 3, "type": "code", "linesLength": 1, "startIndex": 12, "lines": ["ax = data['A Ratings'].plot.bar()"]}, {"block": 4, "type": "code", "linesLength": 9, "startIndex": 13, "lines": ["a_average = (data.loc[:, 'A Ratings'] * data.loc[:, 'A Number']).sum() / data.loc[:, 'A Number'].sum(axis=0)\n", "b_average = (data.loc[:, 'B Ratings'] * data.loc[:, 'B Number']).sum() / data.loc[:, 'B Number'].sum(axis=0)\n", "\n", "\n", "data.loc['Combined'] = [a_average, \n", "                        b_average, \n", "                        data['A Number'].sum(), \n", "                        data['B Number'].sum()]\n", "data.round(2)"]}, {"block": 5, "type": "markdown", "linesLength": 3, "startIndex": 22, "lines": ["# Hours of Exercise vs Chance of a Heart Attack\n", "\n", "This is another fictional example showing Simpson's Paradox in the context of a correlation. When looking at the data individually, there is a negative correlation between hours of exercise and chance of a heart attack, but when aggregating the data, the correlation reverses! "]}, {"block": 6, "type": "code", "linesLength": 1, "startIndex": 25, "lines": ["from numpy.polynomial.polynomial import polyfit"]}, {"block": 7, "type": "code", "linesLength": 26, "startIndex": 26, "lines": ["n_samples = 100\n", "ages = np.random.randint(20, 50, n_samples)\n", "hours = np.random.randint(1, 5, n_samples) + np.random.randn(n_samples)\n", "p = 15 + 0.5 * ages + -2.1 * hours + np.random.randn(n_samples) *  2\n", "under_50 = pd.DataFrame({'age': ages, 'hours': hours, 'probability': p})\n", "\n", "\n", "def plot_relationship(data, c, color = '#d9d142'):\n", "    \"\"\"Plot a scatter plot with linear fit\"\"\"\n", "    x, y = np.array(data[c]), np.array(data['probability'])\n", "    # Linear fit (polynomial of degree 1)\n", "    b, m = polyfit(x, y, 1)\n", "    # Plot scatterplot\n", "    data.plot(x = c, y = 'probability', kind = 'scatter', \n", "              color = color, figsize = (8, 6))\n", "    # Plot linear fit\n", "    plt.plot(x, m * x + b, '-', color = 'k');\n", "    if color == 'b':\n", "        plt.title(f'Probability vs {c.capitalize()} under 50')\n", "    elif color == 'r':\n", "        plt.title(f'Probability vs {c.capitalize()} over 50')\n", "    corr_coef = np.corrcoef(x, y)[0][1]\n", "    ax = plt.gca()\n", "    plt.text(0.2, 0.8, f'{round(corr_coef, 2)}', transform=ax.transAxes)\n", "\n", "plot_relationship(under_50, 'age', '#d9d142')"]}, {"block": 8, "type": "code", "linesLength": 1, "startIndex": 52, "lines": ["plot_relationship(under_50, 'age')"]}, {"block": 9, "type": "code", "linesLength": 1, "startIndex": 53, "lines": ["under_50.plot(x = 'hours', y = 'probability', kind = 'scatter', title = 'P vs Hours of Exercise under 50');"]}, {"block": 10, "type": "code", "linesLength": 7, "startIndex": 54, "lines": ["n_samples = 100\n", "ages = np.random.randint(50, 85, n_samples)\n", "hours = np.random.randint(5, 10, n_samples) + np.random.randn(n_samples) * 0.5\n", "p = 25 + 0.4 * ages + -2 * hours + np.random.randn(n_samples) \n", "over_50 = pd.DataFrame({'age': ages, 'hours': hours, 'probability': p})\n", "\n", "over_50.plot(x = 'age', y = 'probability', kind = 'scatter', title = 'P vs Age over 50');"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 61, "lines": ["plot_relationship(over_50, 'age', '#04c5ff')"]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 62, "lines": ["over_50.plot(x = 'hours', y = 'probability', kind = 'scatter', title = 'P vs Hours of Exercise over 50');"]}, {"block": 13, "type": "code", "linesLength": 2, "startIndex": 63, "lines": ["combined = pd.concat([under_50, over_50], axis = 0)\n", "combined.plot(x = 'hours', y = 'probability', kind = 'scatter', title = 'P vs Hours of Exercise Combined');"]}, {"block": 14, "type": "code", "linesLength": 0, "startIndex": 65, "lines": []}]