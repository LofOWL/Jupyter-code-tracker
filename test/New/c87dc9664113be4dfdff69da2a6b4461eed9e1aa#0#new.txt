[{"block": 0, "type": "markdown", "linesLength": 3, "startIndex": 0, "lines": ["#Using icsound\n", "\n", "By: Andres Cabrera mantaraya36@gmail.com"]}, {"block": 1, "type": "heading", "linesLength": 1, "startIndex": 3, "lines": ["Starting the Csound engine"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 4, "lines": ["To use *icsound* create an icsound instance:"]}, {"block": 3, "type": "code", "linesLength": 1, "startIndex": 5, "lines": ["%pylab inline"]}, {"block": 4, "type": "code", "linesLength": 2, "startIndex": 6, "lines": ["import icsound\n", "cs = icsound.icsound()"]}, {"block": 5, "type": "markdown", "linesLength": 1, "startIndex": 8, "lines": ["Then start the engine:"]}, {"block": 6, "type": "code", "linesLength": 1, "startIndex": 9, "lines": ["cs.start_engine()"]}, {"block": 7, "type": "markdown", "linesLength": 1, "startIndex": 10, "lines": ["You can set the properties of the Csound engine with parameters to the start_engine() function."]}, {"block": 8, "type": "code", "linesLength": 1, "startIndex": 11, "lines": ["help(cs.start_engine)"]}, {"block": 9, "type": "markdown", "linesLength": 1, "startIndex": 12, "lines": ["The engine runs in a separate thread, so it doesn't block execution of python."]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 13, "lines": ["cs.start_engine()"]}, {"block": 11, "type": "markdown", "linesLength": 1, "startIndex": 14, "lines": ["Use the *%%csound* magic command to directly type csound language code in the cell and send it to the current engine."]}, {"block": 12, "type": "code", "linesLength": 2, "startIndex": 15, "lines": ["%%csound\n", "gkinstr init 1"]}, {"block": 13, "type": "code", "linesLength": 2, "startIndex": 17, "lines": ["%%csound\n", "print i(gkinstr)"]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 19, "lines": ["So where did it print?"]}, {"block": 15, "type": "code", "linesLength": 1, "startIndex": 20, "lines": ["cs.print_log()"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 21, "lines": ["By default, messages from Csound are not shown, but they are stored in an internal buffer. You can view them with the print_log() function. If the log is getting too long and cinfusing, use the clear_log() function."]}, {"block": 17, "type": "heading", "linesLength": 1, "startIndex": 22, "lines": ["Function tables"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 23, "lines": ["You can create csound f-tables directly from python lists or numpy arrays:"]}, {"block": 19, "type": "code", "linesLength": 2, "startIndex": 24, "lines": ["cs.fill_table(1, [4,5,7,0,8,7,9])\n", "cs.fill_table(2, array([8,7,9, 1, 1, 1]))"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 26, "lines": ["Tables can be plotted in the usual matplotlib way, but icsound provides a plot_table function which styles the graphs."]}, {"block": 21, "type": "code", "linesLength": 3, "startIndex": 27, "lines": ["cs.plot_table(1)\n", "cs.plot_table(2, reuse=True)\n", "grid()"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 30, "lines": ["You can get the function table values from the csound instance:"]}, {"block": 23, "type": "code", "linesLength": 1, "startIndex": 31, "lines": ["cs.get_table_data(1)"]}, {"block": 24, "type": "code", "linesLength": 5, "startIndex": 32, "lines": ["cs.make_table(2, 1024, 10, 1)\n", "cs.make_table(3, 1024, -10, 0.5, 1)\n", "cs.plot_table(2)\n", "cs.plot_table(3, reuse=True)\n", "#ylim((-1.1,1.1))"]}, {"block": 25, "type": "code", "linesLength": 1, "startIndex": 37, "lines": ["cs.get_table_data(2)[100: 105]"]}, {"block": 26, "type": "markdown", "linesLength": 1, "startIndex": 38, "lines": ["If ctypes is available in your system, icsound will use it to significantly speed up data transfer to and from Csound f-tables. The following will create 320 tables with 720 points each:"]}, {"block": 27, "type": "code", "linesLength": 5, "startIndex": 39, "lines": ["randsig = random.random((320, 720))\n", "i = 0\n", "for i,row in enumerate(randsig):\n", "    cs.fill_table(50 + i, row)\n", "    print i, '..', "]}, {"block": 28, "type": "code", "linesLength": 1, "startIndex": 44, "lines": ["cs.plot_table(104)"]}, {"block": 29, "type": "heading", "linesLength": 1, "startIndex": 45, "lines": ["Sending instruments"]}, {"block": 30, "type": "markdown", "linesLength": 1, "startIndex": 46, "lines": ["You can send instruments to the running csound engine with the *%%csound* magic. Any syntax errors will be displayed inline."]}, {"block": 31, "type": "code", "linesLength": 3, "startIndex": 47, "lines": ["%%csound\n", "instr 1\n", "asig asds"]}, {"block": 32, "type": "code", "linesLength": 4, "startIndex": 50, "lines": ["%%csound\n", "instr 1\n", "asig oscil 0.5, 440\n", "outs asig, asig\n"]}, {"block": 33, "type": "code", "linesLength": 5, "startIndex": 54, "lines": ["%%csound\n", "instr 1\n", "asig oscil 0.5, 440\n", "outs asig, asig\n", "endin"]}, {"block": 34, "type": "heading", "linesLength": 1, "startIndex": 59, "lines": ["Channels"]}, {"block": 35, "type": "markdown", "linesLength": 1, "startIndex": 60, "lines": ["Csound channels can be used to send values to Csound. They can affect running instances of instruments by using the invalue/chnget opcodes:"]}, {"block": 36, "type": "code", "linesLength": 1, "startIndex": 61, "lines": ["cs.set_channel(\"val\", 20)"]}, {"block": 37, "type": "markdown", "linesLength": 1, "startIndex": 62, "lines": ["You can also read the channels from Csound. These channels can be set from icsound or within instruments with the outvalue/chnset opcodes:"]}, {"block": 38, "type": "code", "linesLength": 1, "startIndex": 63, "lines": ["cs.get_channel(\"val\")"]}, {"block": 39, "type": "heading", "linesLength": 1, "startIndex": 64, "lines": ["Recording the output"]}, {"block": 40, "type": "markdown", "linesLength": 1, "startIndex": 65, "lines": ["You can record the realtime output from csound: (This requires Csound 6.04 - unrealeased as of this writing...)"]}, {"block": 41, "type": "code", "linesLength": 1, "startIndex": 66, "lines": ["cs.start_record(\"out.wav\")"]}, {"block": 42, "type": "code", "linesLength": 3, "startIndex": 67, "lines": ["cs.send_score(\"i 1 0 1\")\n", "import time\n", "time.sleep(1)"]}, {"block": 43, "type": "code", "linesLength": 1, "startIndex": 70, "lines": ["cs.stop_record()"]}, {"block": 44, "type": "code", "linesLength": 1, "startIndex": 71, "lines": ["!aplay out.wav"]}, {"block": 45, "type": "heading", "linesLength": 1, "startIndex": 72, "lines": ["Remote engines"]}, {"block": 46, "type": "markdown", "linesLength": 1, "startIndex": 73, "lines": ["You can also interact with engines through UDP. Note that not all operations are available, notably reading f-tables, but you can send instruments and note events to the remote engine."]}, {"block": 47, "type": "code", "linesLength": 2, "startIndex": 74, "lines": ["cs_client = icsound.icsound()\n", "cs_client.start_client()"]}, {"block": 48, "type": "code", "linesLength": 1, "startIndex": 76, "lines": ["cs.clear_log()"]}, {"block": 49, "type": "markdown", "linesLength": 1, "startIndex": 77, "lines": ["Now send notes and instruments from the client:"]}, {"block": 50, "type": "code", "linesLength": 2, "startIndex": 78, "lines": ["cs_client.send_score(\"i 1 0 1\")\n", "cs_client.send_code(\"print i(gkinstr)\")"]}, {"block": 51, "type": "markdown", "linesLength": 1, "startIndex": 80, "lines": ["And show the log in the server:"]}, {"block": 52, "type": "code", "linesLength": 1, "startIndex": 81, "lines": ["cs.print_log()"]}, {"block": 53, "type": "heading", "linesLength": 1, "startIndex": 82, "lines": ["Stopping the engine"]}, {"block": 54, "type": "code", "linesLength": 1, "startIndex": 83, "lines": ["cs.stop_engine()"]}, {"block": 55, "type": "code", "linesLength": 1, "startIndex": 84, "lines": ["cs"]}, {"block": 56, "type": "code", "linesLength": 1, "startIndex": 85, "lines": ["cs.stop_engine()"]}, {"block": 57, "type": "heading", "linesLength": 1, "startIndex": 86, "lines": ["Audification"]}, {"block": 58, "type": "markdown", "linesLength": 1, "startIndex": 87, "lines": ["Reading Earthquake data through a web API:"]}, {"block": 59, "type": "code", "linesLength": 7, "startIndex": 88, "lines": ["prefix = 'http://service.iris.edu/irisws/timeseries/1/query?'\n", "SCNL_parameters = 'net=IU&sta=ANMO&loc=00&cha=BHZ&'\n", "times = 'starttime=2005-01-01T00:00:00&endtime=2005-01-02T00:00:00&'\n", "output = 'output=ascii'\n", "import urllib2\n", "f = urllib2.urlopen(prefix + SCNL_parameters + times + output)\n", "timeseries = f.read()"]}, {"block": 60, "type": "code", "linesLength": 10, "startIndex": 95, "lines": ["data = timeseries.split('\\n')\n", "dates = []\n", "values = []\n", "\n", "for line in data[1:-1]:\n", "    date, val = line.split()\n", "    dates.append(date)\n", "    values.append(float(val))\n", "\n", "plot(values)"]}, {"block": 61, "type": "code", "linesLength": 2, "startIndex": 105, "lines": ["cs.start_engine()\n", "cs.fill_table(1, values)"]}, {"block": 62, "type": "markdown", "linesLength": 1, "startIndex": 107, "lines": ["Instrument to play back the earthquake data stored in a table:"]}, {"block": 63, "type": "code", "linesLength": 7, "startIndex": 108, "lines": ["%%csound\n", "instr 1\n", "idur = p3\n", "itable = p4\n", "asig poscil 1/8000, 1/p3, p4\n", "outs asig, asig\n", "endin"]}, {"block": 64, "type": "markdown", "linesLength": 1, "startIndex": 115, "lines": ["Listen:"]}, {"block": 65, "type": "code", "linesLength": 1, "startIndex": 116, "lines": ["cs.send_score('i 1 0 3 1')"]}, {"block": 66, "type": "markdown", "linesLength": 1, "startIndex": 117, "lines": ["Slower:"]}, {"block": 67, "type": "code", "linesLength": 1, "startIndex": 118, "lines": ["cs.send_score('i 1 0 7 1')"]}, {"block": 68, "type": "code", "linesLength": 1, "startIndex": 119, "lines": ["cs.send_score('i 1 0 1 1')"]}, {"block": 69, "type": "heading", "linesLength": 1, "startIndex": 120, "lines": ["Parameter mapping sonification"]}, {"block": 70, "type": "markdown", "linesLength": 1, "startIndex": 121, "lines": ["Get financial data through a web API:"]}, {"block": 71, "type": "code", "linesLength": 25, "startIndex": 122, "lines": ["import xml.etree.ElementTree as ET\n", "import urllib2\n", "from datetime import datetime\n", "\n", "symbols = 'MSFT', 'GOOG'\n", "\n", "data = {}\n", "\n", "for symbol in symbols:\n", "    url = 'http://chartapi.finance.yahoo.com/instrument/1.0/' + \\\n", "        symbol + '/chartdata;type=quote;range=1y/xml'\n", "    f = urllib2.urlopen(url)\n", "    root = ET.fromstring(f.read())\n", "    \n", "    dates = []\n", "    values = []\n", "    for v in root[2].findall('p'):\n", "        dateval = v.attrib['ref']\n", "        date = datetime(year=int(dateval[0:4]), month=int(dateval[4:6]), day=int(dateval[6:8])) \n", "        dates.append(date)\n", "        entryvalues = []\n", "        for num in v:\n", "            entryvalues.append(float(num.text))\n", "        values.append(entryvalues)\n", "    data[symbol] = [dates, array(values)]"]}, {"block": 72, "type": "code", "linesLength": 2, "startIndex": 147, "lines": ["cs.fill_table(1,data['GOOG'][1][:,1] - min(data['GOOG'][1][:,1]) )\n", "cs.fill_table(2,data['MSFT'][1][:,1] - min(data['MSFT'][1][:,1]) )"]}, {"block": 73, "type": "code", "linesLength": 2, "startIndex": 149, "lines": ["cs.plot_table(1)\n", "title('GOOG')"]}, {"block": 74, "type": "code", "linesLength": 2, "startIndex": 151, "lines": ["cs.plot_table(2)\n", "title('MSFT')"]}, {"block": 75, "type": "code", "linesLength": 18, "startIndex": 153, "lines": ["%%csound\n", "gisine ftgen 0, 0, 4096, 10, 1\n", "\n", "instr 5\n", "\n", "    amoddepth poscil 1/2, 1/p3, 2\n", "    acarfreq poscil 3, 1/p3, 1\n", "    acmratio = amoddepth*10\n", "\n", "    aphs phasor 220 + acarfreq\n", "    \n", "    aphsmod oscili amoddepth/2, acarfreq*( acmratio)\n", "\n", "    asig table3 aphs + aphsmod, gisine, 1, 0, 1\n", "    aenv linen 0.2, 0.01, p3, 0.01\n", "    outs asig*aenv, asig*aenv\n", "\n", "endin"]}, {"block": 76, "type": "code", "linesLength": 1, "startIndex": 171, "lines": ["cs.send_score('i 5 0 20')"]}, {"block": 77, "type": "code", "linesLength": 1, "startIndex": 172, "lines": ["cs.send_score('i -5 0 20')"]}, {"block": 78, "type": "code", "linesLength": 19, "startIndex": 173, "lines": ["%%csound\n", "gisine ftgen 0, 0, 4096, 10, 1\n", "\n", "instr 7\n", "\n", "    kratiofactor chnget \"factor\"\n", "    amoddepth poscil 1/2, 1/p3, 2\n", "    acarfreq poscil 3, 1/p3, 1\n", "    acmratio = amoddepth*kratiofactor\n", "\n", "    aphs phasor 220 + acarfreq\n", "    \n", "    aphsmod oscili amoddepth/2, acarfreq*( acmratio)\n", "\n", "    asig table3 aphs + aphsmod, gisine, 1, 0, 1\n", "    aenv linen 0.2, 0.01, p3, 0.01\n", "    outs asig*aenv, asig*aenv\n", "\n", "endin"]}, {"block": 79, "type": "code", "linesLength": 1, "startIndex": 192, "lines": ["cs.send_score('i 7 0 40')"]}, {"block": 80, "type": "code", "linesLength": 1, "startIndex": 193, "lines": ["cs.set_channel(\"factor\", 0.1)"]}, {"block": 81, "type": "code", "linesLength": 2, "startIndex": 194, "lines": ["cs.plot_table(1)\n", "cs.plot_table(2)"]}, {"block": 82, "type": "heading", "linesLength": 1, "startIndex": 196, "lines": ["Other tests"]}, {"block": 83, "type": "markdown", "linesLength": 1, "startIndex": 197, "lines": ["Another engine:"]}, {"block": 84, "type": "code", "linesLength": 1, "startIndex": 198, "lines": ["ics = icsound.icsound()"]}, {"block": 85, "type": "code", "linesLength": 1, "startIndex": 199, "lines": ["ics.start_engine(buffersize=64)"]}, {"block": 86, "type": "code", "linesLength": 1, "startIndex": 200, "lines": ["ics.list_interfaces()"]}, {"block": 87, "type": "code", "linesLength": 6, "startIndex": 201, "lines": ["%%csound\n", "\n", "instr 1\n", "asig oscil 0.5, 440\n", "outs asig, asig\n", "endin"]}, {"block": 88, "type": "code", "linesLength": 1, "startIndex": 207, "lines": ["ics.send_score(\"i 1 0 0.5\")"]}, {"block": 89, "type": "code", "linesLength": 1, "startIndex": 208, "lines": ["ics.stop_engine()"]}, {"block": 90, "type": "code", "linesLength": 1, "startIndex": 209, "lines": ["del ics"]}]