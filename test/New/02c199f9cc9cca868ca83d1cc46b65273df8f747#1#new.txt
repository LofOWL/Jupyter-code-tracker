[{"block": 0, "type": "markdown", "linesLength": 2, "startIndex": 0, "lines": ["# Introduction\n", "State notebook purpose here"]}, {"block": 1, "type": "markdown", "linesLength": 2, "startIndex": 2, "lines": ["### Imports\n", "Import libraries and write settings here."]}, {"block": 2, "type": "code", "linesLength": 15, "startIndex": 4, "lines": ["import numpy as np\n", "import xarray as xr\n", "import holoviews as hv\n", "import geoviews as gv\n", "import geoviews.feature as gf\n", "\n", "\n", "import pandas as pd \n", "import numpy as np\n", "from cartopy import crs\n", "from geoviews import opts\n", "\n", "gv.extension('matplotlib')\n", "\n", "gv.output(size=150)"]}, {"block": 3, "type": "code", "linesLength": 3, "startIndex": 19, "lines": ["from sqlalchemy import create_engine\n", "engine = create_engine('postgres://localhost:5432/global_fishing_watch')\n", "engine.table_names()"]}, {"block": 4, "type": "code", "linesLength": 11, "startIndex": 22, "lines": ["xr_ensemble = xr.open_dataset('geoviews-examples/data/ensemble.nc').load()\n", "\n", "def get_fishing_effort(nrows):\n", "    df = pd.read_sql(f\"\"\"SELECT * FROM fishing_effort LIMIT {nrows}\"\"\",\n", "             engine, parse_dates=['date'])\n", "    df['flag'] = df['flag'].astype('category')\n", "    df['geartype'] = df['geartype'].astype('category')\n", "    return df\n", "\n", "df = get_fishing_effort(100000)\n", "df.info()"]}, {"block": 5, "type": "code", "linesLength": 1, "startIndex": 33, "lines": ["from holoviews.operation.datashader import datashade, rasterize"]}, {"block": 6, "type": "code", "linesLength": 8, "startIndex": 34, "lines": ["import holoviews as hv\n", "from holoviews import opts\n", "import dask.dataframe as dd\n", "import datashader as ds\n", "import geoviews as gv\n", "\n", "from holoviews.operation.datashader import datashade, rasterize\n", "hv.extension('bokeh')"]}, {"block": 7, "type": "code", "linesLength": 5, "startIndex": 42, "lines": ["dataset = hv.Dataset(df)\n", "grouped = dataset.to(hv.Points, ['longitude', 'latitude'], \n", "                     groupby=['date'])\n", "rasterized = rasterize(grouped)\n", "rasterized.opts(height=600, width=800, tools=['hover'], xaxis=None, yaxis=None, logz=True)"]}, {"block": 8, "type": "code", "linesLength": 2, "startIndex": 47, "lines": ["points = hv.Points(df, kdims=['latitude', 'longitude'])\n", "points * gf.ocean * gf.coastline "]}, {"block": 9, "type": "code", "linesLength": 8, "startIndex": 49, "lines": ["def get_fishing_by_vessel(nrows):\n", "    df = pd.read_sql(f\"\"\"SELECT * FROM fishing_effort_by_vessel LIMIT {nrows}\"\"\",\n", "             engine, parse_dates=['date'])\n", "    df = df.set_index('mmsi')\n", "    return df\n", "    \n", "vessels = get_fishing_by_vessel(100000)\n", "vessels.head()"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 57, "lines": ["la, li, times, new_vessels = format_df(vessels)"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 58, "lines": ["new_vessels.head()"]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 59, "lines": ["la.shape, li.shape, times.shape"]}, {"block": 13, "type": "code", "linesLength": 2, "startIndex": 60, "lines": ["fishing_data = xr.Dataset.from_dataframe(new_vessels[['fishing_hours']])\n", "fishing_data"]}, {"block": 14, "type": "code", "linesLength": 2, "startIndex": 62, "lines": ["gdata = gv.Dataset(fishing_data)\n", "gdata"]}, {"block": 15, "type": "code", "linesLength": 1, "startIndex": 64, "lines": ["gdata.to(gv.Image, ['longitude', 'latitude']) * gv.feature.coastline * gv.feature.land"]}, {"block": 16, "type": "code", "linesLength": 4, "startIndex": 65, "lines": ["from itertools import product\n", "\n", "combos = list(product(la, li, times))\n", "len(combos)"]}, {"block": 17, "type": "code", "linesLength": 3, "startIndex": 69, "lines": ["las = [c[0] for c in combos]\n", "lis = [c[1] for c in combos]\n", "ts = [c[2] for c in combos]"]}, {"block": 18, "type": "code", "linesLength": 2, "startIndex": 72, "lines": ["t = pd.DataFrame(index = pd.MultiIndex.from_tuples(combos))\n", "t.head()"]}, {"block": 19, "type": "code", "linesLength": 1, "startIndex": 74, "lines": ["new_vessels.index.names"]}, {"block": 20, "type": "code", "linesLength": 2, "startIndex": 75, "lines": ["t.index.names = ['latitude', 'longitude', 'date']\n", "t.merge(new_vessels, left_index=True, right_index=True, how='left')"]}, {"block": 21, "type": "code", "linesLength": 3, "startIndex": 77, "lines": ["pd.read_sql(\"\"\"SELECT * FROM fishing_effort_by_vessel fe\n", "               JOIN fishing_vessels fv ON fe.mmsi = fv.mmsi\n", "                LIMIT 10000\"\"\", engine)"]}, {"block": 22, "type": "code", "linesLength": 1, "startIndex": 80, "lines": ["fishing_data.to_dataframe().shape"]}, {"block": 23, "type": "code", "linesLength": 1, "startIndex": 81, "lines": ["new_vessels.fishing_hours.shape"]}, {"block": 24, "type": "code", "linesLength": 2, "startIndex": 82, "lines": ["xr.Dataset(data_vars=(a\n", "                     )'fishing_hours')"]}, {"block": 25, "type": "code", "linesLength": 10, "startIndex": 84, "lines": ["def format_df(df, n=10_000):\n", "    ...:     df = df.iloc[:n]\n", "    ...:     df = df.drop_duplicates(subset=['latitude', 'longitude', 'date'])\n", "    ...:     df = df.sort_values(['latitude', 'longitude', 'date'])\n", "    ...:     index = pd.MultiIndex.from_arrays([df['latitude'], df['longitude'], df['date']])\n", "    ...:     df.index = index\n", "    ...:     latitudes = df.index.levels[0]\n", "    ...:     longitudes = df.index.levels[1]\n", "    ...:     times = df.index.levels[2]\n", "    ...:     return latitudes, longitudes, times, df"]}, {"block": 26, "type": "code", "linesLength": 1, "startIndex": 94, "lines": ["la, li, ti, new_df = format_df(df, 150)"]}, {"block": 27, "type": "code", "linesLength": 2, "startIndex": 95, "lines": ["xdata = xr.Dataset.from_dataframe(new_df[['fishing_hours', 'mmsi_present']])\n", "gdata = gv.Dataset(xdata, kdims=['date', 'longitude', 'latitude'], vdims=['fishing_hours'])"]}, {"block": 28, "type": "code", "linesLength": 8, "startIndex": 97, "lines": ["from geoviews import opts\n", "\n", "gv.extension('bokeh', 'matplotlib')\n", "\n", "opts.defaults(\n", "    opts.Image(width=600, height=400, colorbar=True),\n", "    opts.Feature(apply_ranges=False),\n", "    opts.QuadMesh(width=600, height=400, colorbar=True))"]}, {"block": 29, "type": "code", "linesLength": 2, "startIndex": 105, "lines": ["quadmeshes = gdata.to(gv.QuadMesh, ['longitude', 'latitude'], dynamic=True)\n", "quadmeshes * gv.feature.coastline"]}, {"block": 30, "type": "code", "linesLength": 1, "startIndex": 107, "lines": ["def get_fishing_effort(nrows)"]}, {"block": 31, "type": "code", "linesLength": 1, "startIndex": 108, "lines": ["gdata.to(gv.Image, ['longitude', 'latitude']) * gv.feature.coastline"]}, {"block": 32, "type": "code", "linesLength": 1, "startIndex": 109, "lines": ["new_df"]}, {"block": 33, "type": "code", "linesLength": 30, "startIndex": 110, "lines": ["# Data manipulation\n", "import pandas as pd\n", "import numpy as np\n", "\n", "# Options for pandas\n", "pd.options.display.max_columns = 50\n", "pd.options.display.max_rows = 30\n", "\n", "# Display all cell outputs\n", "from IPython.core.interactiveshell import InteractiveShell\n", "InteractiveShell.ast_node_interactivity = 'all'\n", "\n", "from IPython import get_ipython\n", "ipython = get_ipython()\n", "\n", "# autoreload extension\n", "if 'autoreload' not in ipython.extension_manager.loaded:\n", "    %load_ext autoreload\n", "\n", "%autoreload 2\n", "\n", "# Visualizations\n", "import plotly.plotly as py\n", "import plotly.graph_objs as go\n", "from plotly.offline import iplot, init_notebook_mode\n", "init_notebook_mode(connected=True)\n", "\n", "import cufflinks as cf\n", "cf.go_offline(connected=True)\n", "cf.set_config_file(theme='white')"]}, {"block": 34, "type": "markdown", "linesLength": 2, "startIndex": 140, "lines": ["# Analysis/Modeling\n", "Do work here"]}, {"block": 35, "type": "markdown", "linesLength": 2, "startIndex": 142, "lines": ["# Results\n", "Show graphs and stats here"]}, {"block": 36, "type": "markdown", "linesLength": 2, "startIndex": 144, "lines": ["# Conclusions and Next Steps\n", "Summarize findings here"]}, {"block": 37, "type": "code", "linesLength": 0, "startIndex": 146, "lines": []}, {"block": 38, "type": "code", "linesLength": 0, "startIndex": 146, "lines": []}, {"block": 39, "type": "code", "linesLength": 0, "startIndex": 146, "lines": []}]