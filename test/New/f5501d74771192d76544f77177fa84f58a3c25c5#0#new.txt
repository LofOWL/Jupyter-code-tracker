[{"block": 0, "type": "markdown", "linesLength": 3, "startIndex": 0, "lines": ["# Introduction: Interacting with Slack from Python\n", "\n", "In this notebook, we will use `Slacker` to interact with Slack. This allows us to send messages and upload files, which can be useful when training models, or monitoring scripts (or just for fun of course)!"]}, {"block": 1, "type": "code", "linesLength": 1, "startIndex": 3, "lines": ["!pip install -q -U Slacker"]}, {"block": 2, "type": "code", "linesLength": 11, "startIndex": 4, "lines": ["import numpy as np\n", "import pandas as pd\n", "\n", "# Slacker \n", "from slacker import Slacker\n", "\n", "# Plotting\n", "import matplotlib.pyplot as plt\n", "import seaborn as sns\n", "%matplotlib inline\n", "plt.style.use('fivethirtyeight')"]}, {"block": 3, "type": "markdown", "linesLength": 5, "startIndex": 15, "lines": ["# Get a Slack Legacy API Token\n", "\n", "https://api.slack.com/custom-integrations/legacy-tokens\n", "\n", "Store in a safe location (not on GitHub)!"]}, {"block": 4, "type": "markdown", "linesLength": 3, "startIndex": 20, "lines": ["## Authenticate with Slack\n", "\n", "Read in slack api token. Replace the line below with the location of your slack api token."]}, {"block": 5, "type": "code", "linesLength": 2, "startIndex": 23, "lines": ["with open('C:/Users/willk/OneDrive/Desktop/slack_api_python.txt', 'r') as f:\n", "    slack_api_token = f.read()"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 25, "lines": ["Authenticate with slack and print out channels to make sure everything worked."]}, {"block": 7, "type": "code", "linesLength": 6, "startIndex": 26, "lines": ["# Connect to Slack\n", "slack = Slacker(slack_api_token)\n", "channels = slack.channels.list()\n", "\n", "for channel in channels.body['channels']:\n", "    print(f'Channel {channel[\"name\"]} Purpose: {channel[\"purpose\"][\"value\"]} ID: {channel[\"id\"]}\\n')"]}, {"block": 8, "type": "markdown", "linesLength": 3, "startIndex": 32, "lines": ["# Options\n", "\n", "Anything you can do in Slack itself, you can do with `Slacker`. Let's take a look at the options."]}, {"block": 9, "type": "code", "linesLength": 23, "startIndex": 35, "lines": ["from pprint import pprint\n", "\n", "command_dict = {'functions': {},\n", "                'attributes': {}}\n", "\n", "# Modules\n", "for d in dir(slack):\n", "    if not d.startswith('_'):\n", "        command_dict['functions'][d] = []\n", "        command_dict['attributes'][d] = []\n", "        # Iterate through methods and attributes\n", "        for dd in dir(getattr(slack, d)):\n", "            if not dd.startswith('_'):\n", "                # List of methods and attributes\n", "                l = dir(getattr(getattr(slack, d), dd))\n", "                # Method (function)\n", "                if '__call__' in l:\n", "                    command_dict['functions'][d].append(dd)\n", "                # Attributes\n", "                else:\n", "                    command_dict['attributes'][d].append(dd)\n", "                    \n", "pprint(command_dict['functions']['users'])"]}, {"block": 10, "type": "markdown", "linesLength": 1, "startIndex": 58, "lines": ["Let's see how to use one of these. Here we'll list the users and some information."]}, {"block": 11, "type": "code", "linesLength": 3, "startIndex": 59, "lines": ["r = slack.users.list()\n", "for member in r.body['members']:\n", "    print(f\"Real name: {member['real_name']:12} Time Zone: {member['tz']} Status: {member['profile']['status_text']}\")"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 62, "lines": ["`r` is a response object. For each method, there will be different pieces of information you can retrieve."]}, {"block": 13, "type": "code", "linesLength": 1, "startIndex": 63, "lines": ["r.body['members'][0]['profile']['image_original']"]}, {"block": 14, "type": "code", "linesLength": 3, "startIndex": 64, "lines": ["from IPython.display import Image\n", "\n", "Image(url='https://avatars.slack-edge.com/2018-08-22/421515326835_af6fa36ec0b3f86e86ae_original.jpg', embed=True)"]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 67, "lines": ["Of course, we can change this image if we aren't happy with it! "]}, {"block": 16, "type": "code", "linesLength": 1, "startIndex": 68, "lines": ["r.body"]}, {"block": 17, "type": "code", "linesLength": 1, "startIndex": 69, "lines": ["slack.users.get_user_id('Will Koehrsen')"]}, {"block": 18, "type": "code", "linesLength": 1, "startIndex": 70, "lines": ["w = slack.users"]}, {"block": 19, "type": "code", "linesLength": 1, "startIndex": 71, "lines": ["r = w.profile.set(user='UCEKVNHPH', name='display_name', value = '123')"]}, {"block": 20, "type": "code", "linesLength": 1, "startIndex": 72, "lines": ["r.successful"]}, {"block": 21, "type": "code", "linesLength": 3, "startIndex": 73, "lines": ["slack.channels.create('python_content2')\n", "new_id = slack.channels.get_channel_id('python_content2')\n", "r = slack.channels.history(new_id)"]}, {"block": 22, "type": "code", "linesLength": 1, "startIndex": 76, "lines": ["r.body"]}, {"block": 23, "type": "code", "linesLength": 1, "startIndex": 77, "lines": ["slack.channels.get_channel_id('random')"]}, {"block": 24, "type": "code", "linesLength": 1, "startIndex": 78, "lines": ["slack.chat.post_message('random', 'Using no id')"]}, {"block": 25, "type": "code", "linesLength": 1, "startIndex": 79, "lines": ["slack.chat.post_message(slack.channels.get_channel_id('random'), 'Using an id')"]}, {"block": 26, "type": "code", "linesLength": 8, "startIndex": 80, "lines": ["slack.channels.set_purpose('#testing_exp', 'Deep philosophical discussions around the water cooler.')\n", "slack.channels.create('python_content')\n", "slack.channels.set_purpose('python_content', 'Sharing great python related resources')\n", "\n", "channels = slack.channels.list()\n", "\n", "for channel in channels.body['channels']:\n", "    print(f'Channel {channel[\"name\"]} Purpose: {channel[\"purpose\"][\"value\"]}\\n')"]}, {"block": 27, "type": "code", "linesLength": 5, "startIndex": 88, "lines": ["from PIL import Image\n", "import requests\n", "url = user['profile']['image_192']\n", "im = Image.open(requests.get(url, stream=True).raw)\n", "plt.imshow(im)"]}, {"block": 28, "type": "code", "linesLength": 1, "startIndex": 93, "lines": ["PIL.Image.from"]}, {"block": 29, "type": "code", "linesLength": 15, "startIndex": 94, "lines": ["from IPython.display import Image\n", "from PIL import Image\n", "import PIL\n", "users = slack.users.list()\n", "\n", "for user in users.body['members']:\n", "    # Print some information\n", "    print(f'\\nUser: {user[\"name\"]}, Real Name: {user[\"real_name\"]}, Time Zone: {user[\"tz_label\"]}.')\n", "    print(f'Current Status: {user[\"profile\"][\"status_text\"]}')\n", "    # Get image data and show\n", "    plt.figure(facecolor = 'w')\n", "    plt.imshow(Image.open(requests.get(user['profile']['image_192'], stream=True).raw))\n", "    plt.axis('off');\n", "    plt.grid('off');\n", "    plt.show();"]}, {"block": 30, "type": "code", "linesLength": 2, "startIndex": 109, "lines": ["plt.plot(np.random.randn(100), np.random.randn(100), 'ro')\n", "plt.savefig('first_plot.png')"]}, {"block": 31, "type": "code", "linesLength": 1, "startIndex": 111, "lines": ["slack.files.upload('first_plot.png', channels = ['testing_exp', 'slack_interaction']);"]}, {"block": 32, "type": "code", "linesLength": 1, "startIndex": 112, "lines": ["Image(user['profile']['image_192'])"]}, {"block": 33, "type": "code", "linesLength": 2, "startIndex": 113, "lines": ["\n", "Image('https://secure.gravatar.com/avatar/f85b7564fd35d5c86054b95090052d94.jpg?s=192&d=https%3A%2F%2Fa.slack-edge.com%2F7fa9%2Fimg%2Favatars%2Fava_0025-192.png')"]}, {"block": 34, "type": "code", "linesLength": 1, "startIndex": 115, "lines": ["users.body['members']"]}, {"block": 35, "type": "code", "linesLength": 1, "startIndex": 116, "lines": ["x = slack.channels.list()"]}, {"block": 36, "type": "code", "linesLength": 1, "startIndex": 117, "lines": ["x.body"]}, {"block": 37, "type": "code", "linesLength": 0, "startIndex": 118, "lines": []}]