[{"block": 0, "type": "markdown", "linesLength": 4, "startIndex": 0, "lines": ["# Observing shooting stars\n", "\n", "\n", "Average time between shooting stars = 15 minutes. What is the probability of seeing 4 stars in one hour?"]}, {"block": 1, "type": "code", "linesLength": 23, "startIndex": 4, "lines": ["# Standard data science\n", "import pandas as pd\n", "import numpy as np\n", "\n", "%load_ext autoreload\n", "%autoreload 2\n", "\n", "# Options for pandas\n", "pd.options.display.max_columns = 20\n", "\n", "# Display all cell outputs\n", "from IPython.core.interactiveshell import InteractiveShell\n", "InteractiveShell.ast_node_interactivity = 'all'\n", "\n", "# Visualizations\n", "import plotly.plotly as py\n", "import plotly.graph_objs as go\n", "from plotly.offline import iplot\n", "\n", "# Cufflinks for dataframes\n", "import cufflinks as cf\n", "cf.go_offline()\n", "cf.set_config_file(world_readable=True, theme='white')"]}, {"block": 2, "type": "code", "linesLength": 2, "startIndex": 27, "lines": ["from scipy.special import factorial\n", "import pymc3 as pm"]}, {"block": 3, "type": "code", "linesLength": 5, "startIndex": 29, "lines": ["rate = 1/15\n", "minutes = 60\n", "\n", "ns = np.arange(100)\n", "p_n = np.exp(-rate * minutes) * ((rate * minutes) ** ns) / factorial(ns)"]}, {"block": 4, "type": "code", "linesLength": 1, "startIndex": 34, "lines": ["p_n[ns > 4].sum()"]}, {"block": 5, "type": "code", "linesLength": 1, "startIndex": 35, "lines": ["p_n[ns<4].sum()"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 36, "lines": ["# Binomial Versus Poisson Distribution"]}, {"block": 7, "type": "code", "linesLength": 2, "startIndex": 37, "lines": ["trials = np.random.binomial(100, rate, size=10000)\n", "trials.mean()"]}, {"block": 8, "type": "code", "linesLength": 2, "startIndex": 39, "lines": ["trials_poisson = np.random.poisson(rate*spins, size=10000)\n", "trials_poisson.mean()"]}, {"block": 9, "type": "code", "linesLength": 5, "startIndex": 41, "lines": ["def plot_hist(x, summary=True):\n", "    df = pd.DataFrame(x)\n", "    df.iplot(kind='hist')\n", "    if summary:\n", "        print(df.describe())"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 46, "lines": ["plot_hist(trials)"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 47, "lines": ["plot_hist(trials_poisson)"]}, {"block": 12, "type": "code", "linesLength": 0, "startIndex": 48, "lines": []}, {"block": 13, "type": "markdown", "linesLength": 1, "startIndex": 48, "lines": ["# Distribution"]}, {"block": 14, "type": "code", "linesLength": 6, "startIndex": 49, "lines": ["spins = 100\n", "rate = 1/38\n", "\n", "def calc_prob_number(rate, number, trials):\n", "    lam = rate * trials\n", "    return np.exp(-lam) * (np.power(lam, number)) / factorial(number)"]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 55, "lines": ["Expected successes per 1000 spins"]}, {"block": 16, "type": "code", "linesLength": 2, "startIndex": 56, "lines": ["lam = rate*spins\n", "lam"]}, {"block": 17, "type": "code", "linesLength": 2, "startIndex": 58, "lines": ["ns = np.arange(100)\n", "p_n = calc_prob_number(rate, ns, spins)"]}, {"block": 18, "type": "code", "linesLength": 1, "startIndex": 60, "lines": ["p_n[ns >= 3].sum()"]}, {"block": 19, "type": "code", "linesLength": 4, "startIndex": 61, "lines": ["figure = go.Figure(data=[go.Scatter(x=ns, y=p_n, mode='markers+lines')], layout=go.Layout(xaxis=dict(title='Successes'),\n", "                                                                                         yaxis=dict(title='Density'),\n", "                                                                                         title='Probability Distribution of Number of Successes per 100 Spins'))\n", "iplot(figure)"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 65, "lines": ["Try using different rates."]}, {"block": 21, "type": "code", "linesLength": 1, "startIndex": 66, "lines": ["ra"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 67, "lines": ["Alternative using numpy"]}, {"block": 23, "type": "code", "linesLength": 6, "startIndex": 68, "lines": ["n = np.random.poisson(lam, size=int(1e4))\n", "\n", "df = pd.DataFrame({'n': n})\n", "df['n'].iplot(kind='hist', xTitle='successes / 1000 spins', \n", "              yTitle='Count', \n", "              title='Histogram of Successes in 1000 spins for 10000 Trials')"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 74, "lines": ["# Waiting Time"]}, {"block": 25, "type": "code", "linesLength": 2, "startIndex": 75, "lines": ["ts = np.arange(200)\n", "p_t = np.exp(-rate * ts)"]}, {"block": 26, "type": "code", "linesLength": 4, "startIndex": 77, "lines": ["figure = go.Figure(data=[go.Scatter(x=ts, y=p_t / p_t.sum(), mode='markers+lines')], layout=go.Layout(xaxis=dict(title='Waiting Time (spins)'),\n", "                                                                                         yaxis=dict(title='Density'),\n", "                                                                                         title='Probability Distribution of Waiting Time'))\n", "iplot(figure)"]}, {"block": 27, "type": "code", "linesLength": 1, "startIndex": 81, "lines": ["np.argmax(ts * p_t)"]}, {"block": 28, "type": "markdown", "linesLength": 1, "startIndex": 82, "lines": ["Probability of waiting more than 100 spins."]}, {"block": 29, "type": "code", "linesLength": 1, "startIndex": 83, "lines": ["np.exp(-rate * 100)"]}, {"block": 30, "type": "code", "linesLength": 24, "startIndex": 84, "lines": ["from math import pow, exp, factorial\n", "\n", "class Exponential:\n", "\n", "    def __init__(self, rate):\n", "        self.rate = rate\n", "\n", "    def prob_less_than_or_equal(self, t):\n", "        rate = self.rate * t\n", "        return 1 - exp(-rate)\n", "\n", "    def prob_greater_than(self, t):\n", "        return 1 - self.prob_less_than_or_equal(t)\n", "\n", "    def prob_between(self, t1, t2):\n", "        p1 = self.prob_less_than_or_equal(t1)\n", "        p2 = self.prob_less_than_or_equal(t2)\n", "\n", "        return p2 - p1\n", "\n", "expo = Exponential(1/38)\n", "print(expo.prob_greater_than(100))\n", "print(expo.prob_less_than_or_equal(100))\n", "print(expo.prob_between(50, 150))"]}, {"block": 31, "type": "markdown", "linesLength": 1, "startIndex": 108, "lines": ["# Arrivals"]}, {"block": 32, "type": "code", "linesLength": 1, "startIndex": 109, "lines": ["rand.rand(2)"]}, {"block": 33, "type": "code", "linesLength": 5, "startIndex": 110, "lines": ["spins = 10000\n", "time_between = 36  \n", "\n", "rand = np.random.RandomState(42)\n", "success_times = spins * time_between * np.sort(rand.rand(spins))"]}, {"block": 34, "type": "code", "linesLength": 6, "startIndex": 115, "lines": ["waiting_times = np.diff(success_times)\n", "\n", "df = pd.DataFrame({'waiting_time': waiting_times})\n", "df['waiting_time'].iplot(kind='hist', xTitle='Waiting Time', \n", "              yTitle='Count', bins=(0, 400, 10),\n", "              title='Histogram of Waiting Times')"]}, {"block": 35, "type": "code", "linesLength": 1, "startIndex": 121, "lines": ["np.mean(waiting_times)"]}, {"block": 36, "type": "markdown", "linesLength": 1, "startIndex": 122, "lines": ["# Visualizing Successes"]}, {"block": 37, "type": "code", "linesLength": 4, "startIndex": 123, "lines": ["spins = np.random.choice([0, 1], size = 100, replace=True, p=[1-rate, rate])\n", "success_times = np.where(spins==1)[0]\n", "waiting_times = np.diff(np.where(spins == 1))\n", "waiting_times[:10]"]}, {"block": 38, "type": "code", "linesLength": 1, "startIndex": 127, "lines": ["annotations = [go.layout.Annotation(x=x, y=1, text=str(x), ax=0, ay=200) for x in success_times]"]}, {"block": 39, "type": "code", "linesLength": 3, "startIndex": 128, "lines": ["figure = go.Figure(data=[go.Scatter(x=success_times, y=np.ones(shape=len(success_times)), mode='markers')], \n", "                   layout=go.Layout(annotations=annotations, yaxis=dict(range=(0, 1))))\n", "iplot(figure)"]}, {"block": 40, "type": "code", "linesLength": 1, "startIndex": 131, "lines": ["annotations"]}, {"block": 41, "type": "code", "linesLength": 0, "startIndex": 132, "lines": []}, {"block": 42, "type": "code", "linesLength": 0, "startIndex": 132, "lines": []}]