[{"block": 0, "type": "markdown", "linesLength": 1, "startIndex": 0, "lines": ["<span style=\"float:left;\">Licence CC BY-NC-ND</span><span style=\"float:right;\">Thierry Parmentelat &amp; Arnaud Legout&nbsp;<img src=\"media/both-logos-small-alpha.png\" style=\"display:inline\"></span><br/>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 1, "lines": ["xxx todo manque les f-strings"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 2, "lines": ["# Formatage de cha\u00eenes de caract\u00e8res"]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 3, "lines": ["## Compl\u00e9ment - niveau basique"]}, {"block": 4, "type": "markdown", "linesLength": 1, "startIndex": 4, "lines": ["On d\u00e9signe par formatage les outils qui permettent d'obtenir une pr\u00e9sentation fine des r\u00e9sultats, que ce soit pour am\u00e9liorer la lisibilit\u00e9 lorsqu'on s'adresse \u00e0 des humains, ou pour respecter la syntaxe d'un outil auquel on veut passer les donn\u00e9es pour un traitement ult\u00e9rieur."]}, {"block": 5, "type": "markdown", "linesLength": 1, "startIndex": 5, "lines": ["### L'instruction `print`"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 6, "lines": ["Nous avons jusqu'\u00e0 maintenant presque toujours utilis\u00e9 l'instruction `print` pour afficher nos r\u00e9sultats. Comme on l'a vu, celle-ci r\u00e9alise un formatage sommaire, en ceci qu'elle ins\u00e8re un espace entre les valeurs qui lui sont pass\u00e9es."]}, {"block": 7, "type": "markdown", "linesLength": 1, "startIndex": 7, "lines": ["La seule subtilit\u00e9 notable concernant `print` est que par d\u00e9faut, elle ajoute un saut de ligne \u00e0 la fin; pour \u00e9viter ce comportement, on peut passer \u00e0 la fonction un argument `end`, qui sera ins\u00e9r\u00e9 *au lieu* du saut de ligne. Ainsi par exemple:"]}, {"block": 8, "type": "code", "linesLength": 5, "startIndex": 8, "lines": ["# une premi\u00e8re ligne\n", "print(\"une\", \"seule\", \"ligne\")\n", "# une deuxi\u00e8me ligne en deux appels \u00e0 print\n", "print(\"une\", \"autre\", end=' ')\n", "print(\"ligne\")"]}, {"block": 9, "type": "markdown", "linesLength": 1, "startIndex": 13, "lines": ["Il faut remarquer aussi que `print` est capable d'imprimer **n'importe quel objet**; nous l'avons d\u00e9j\u00e0 fait avec les listes et les tuples, voici par exemple un module:"]}, {"block": 10, "type": "code", "linesLength": 4, "startIndex": 14, "lines": ["# on peut imprimer par exemple un objet 'module' \n", "import math\n", "\n", "print('le module math est', math)"]}, {"block": 11, "type": "markdown", "linesLength": 1, "startIndex": 18, "lines": ["En antipant un peu, voici comment `print` pr\u00e9sente les instances de classe:"]}, {"block": 12, "type": "code", "linesLength": 6, "startIndex": 19, "lines": ["# ou une instance de classe (que nous verrons dans une semaine ult\u00e9rieure)\n", "class Personne: \n", "    pass\n", "\n", "personne = Personne()\n", "print(personne)"]}, {"block": 13, "type": "markdown", "linesLength": 1, "startIndex": 25, "lines": ["### La m\u00e9thode `format`"]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 26, "lines": ["On rencontre assez vite les limites de `print`. D'une part, il peut \u00eatre n\u00e9cessaire de formater une cha\u00eene de caract\u00e8res sans n\u00e9cessairement vouloir l'imprimer, ou en tous cas pas imm\u00e9diatement. D'autre part les espaces ajout\u00e9s peuvent \u00eatre plus n\u00e9fastes qu'utiles."]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 27, "lines": ["On peut dans ces cas-l\u00e0 recourir \u00e0 la m\u00e9thode `format`, qui est d\u00e9finie sur les objets `str`, et qui s'utilise comme suit. Mais d\u00e9finissons d'abord quelques donn\u00e9es \u00e0 afficher."]}, {"block": 16, "type": "code", "linesLength": 3, "startIndex": 28, "lines": ["age = 35\n", "nom = \"Lambert\"\n", "prenom = \"Jacques\""]}, {"block": 17, "type": "markdown", "linesLength": 1, "startIndex": 31, "lines": ["Nous avons choisi des objets simples, mais exactement comme avec `print`, `format` peut accepter n'importe quel type d'objet."]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 32, "lines": ["On peut alors pr\u00e9parer une mise en forme de ces donn\u00e9es comme ceci:"]}, {"block": 19, "type": "code", "linesLength": 1, "startIndex": 33, "lines": ["\"{}, {}, {}ans\".format(nom, prenom, age)"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 34, "lines": ["Dans cet exemple le plus simple, les donn\u00e9es sont affich\u00e9es en lieu et place des `{}`, dans l'ordre o\u00f9 elles sont fournies. "]}, {"block": 21, "type": "markdown", "linesLength": 1, "startIndex": 35, "lines": ["Cela convient bien lorsqu'on a peu de donn\u00e9es; si par la suite on veut changer l'ordre par exemple des nom et pr\u00e9nom, on peut bien s\u00fbr \u00e9changer l'ordre des arguments pass\u00e9s \u00e0 format, ou encore utiliser la **liaison par position**, comme ceci&nbsp;:"]}, {"block": 22, "type": "code", "linesLength": 1, "startIndex": 36, "lines": ["\"{1}, {0}, {2}ans\".format(nom, prenom, age)"]}, {"block": 23, "type": "markdown", "linesLength": 1, "startIndex": 37, "lines": ["Dans la pratique toutefois, cette forme est assez peu utile, on lui pr\u00e9f\u00e8re souvent la **liaison par nom** qui se pr\u00e9sente comme ceci:"]}, {"block": 24, "type": "code", "linesLength": 1, "startIndex": 38, "lines": ["\"{le_prenom}, {le_nom}, {l_age}ans\".format(le_nom=nom, le_prenom=prenom, l_age=age)"]}, {"block": 25, "type": "markdown", "linesLength": 1, "startIndex": 39, "lines": ["Dans ce premier exemple de liaison par nom, nous avons d\u00e9lib\u00e9r\u00e9ment utilis\u00e9 des noms diff\u00e9rents pour les donn\u00e9es externes et pour les noms apparaissant dans le format, pour bien illustrer comment la liaison est r\u00e9solue; mais on peut aussi bien faire tout simplement&nbsp;:"]}, {"block": 26, "type": "code", "linesLength": 1, "startIndex": 40, "lines": ["\"{prenom}, {nom}, {age}ans\".format(nom=nom, prenom=prenom, age=age)"]}, {"block": 27, "type": "markdown", "linesLength": 1, "startIndex": 41, "lines": ["Il est possible de m\u00e9langer la liaison par position et la liaison par nom comme ceci&nbsp;:"]}, {"block": 28, "type": "code", "linesLength": 1, "startIndex": 42, "lines": ["\"{1}, {0}, {age}ans\".format(nom, prenom, age=age)"]}, {"block": 29, "type": "markdown", "linesLength": 1, "startIndex": 43, "lines": ["avec la r\u00e9serve, toutefois que les arguments nomm\u00e9s (ceux avec un `=`) doivent appara\u00eetre **apr\u00e8s** les arguments li\u00e9s par position (ceux sans `=`); les raisons pour ceci vous appara\u00eetront clairement dans quelque temps; ainsi la forme suivante n'est pas accept\u00e9e&nbsp;:"]}, {"block": 30, "type": "markdown", "linesLength": 7, "startIndex": 44, "lines": ["    # il faut donner \u00e0 format les arguments sans noms\n", "    # AVANT les arguments nomm\u00e9s \n", "    \"{1}, {0}, {age}ans\".format(age=age, nom, prenom)\n", "    \n", "    File \"<ipython-input-46-9a8e8e541bf2>\", line 1\n", "        \"{1}, {0}, {age}ans\".format(age=age, nom, prenom)\n", "    SyntaxError: positional argument follows keyword argument"]}, {"block": 31, "type": "markdown", "linesLength": 1, "startIndex": 51, "lines": ["Voici qui conclut notre courte introduction \u00e0 la m\u00e9thode `format`, dont on rappelle toutefois pour \u00eatre bien clair qu'elle **ne r\u00e9alise pas d'impression**, il faut donc la coupler \u00e0 `print` si l'impression est souhait\u00e9e."]}, {"block": 32, "type": "markdown", "linesLength": 1, "startIndex": 52, "lines": ["### Imprimer les instances de classe"]}, {"block": 33, "type": "markdown", "linesLength": 1, "startIndex": 53, "lines": ["Voici enfin, toujours en l\u00e9g\u00e8re anticipation, nous avons vu un peu plus haut comment sont pr\u00e9sent\u00e9es par d\u00e9faut les instances de classe. Pour am\u00e9liorer la lisibilit\u00e9, voici comment utiliser `format` pour red\u00e9finir la fa\u00e7on de pr\u00e9senter les instances d'une classe (nous reverrons cela plus en d\u00e9tails \u00e0 propos des classes):"]}, {"block": 34, "type": "code", "linesLength": 14, "startIndex": 54, "lines": ["# pour red\u00e9finir le comportement de print \n", "# sur les instances de classe\n", "class Vector:\n", "    # constructeur \n", "    def __init__(self, x, y):\n", "        self.x = x\n", "        self.y = y\n", "    \n", "    # red\u00e9finir la fa\u00e7on d'imprimer\n", "    def __repr__(self):\n", "        return \"[Vecteur {} x {}]\".format(self.x, self.y)\n", "\n", "v = Vector(3, 10)\n", "print(v)"]}, {"block": 35, "type": "markdown", "linesLength": 1, "startIndex": 68, "lines": ["## Compl\u00e9ment - niveau interm\u00e9diaire"]}, {"block": 36, "type": "markdown", "linesLength": 1, "startIndex": 69, "lines": ["### La version pr\u00e9c\u00e9dente du formatage : l'op\u00e9rateur `%`"]}, {"block": 37, "type": "markdown", "linesLength": 3, "startIndex": 70, "lines": ["`format` a \u00e9t\u00e9 en fait introduite relativement tardivement dans python, pour remplacer la technique que nous allons pr\u00e9senter maintenant. \n", "\n", "Il est conseill\u00e9 d'utiliser exclusivement `format` pour le code que vous \u00e9crirez, mais \u00e9tant donn\u00e9 le volume de code qui a \u00e9t\u00e9 \u00e9crit avec l'op\u00e9rateur `%`, il nous a sembl\u00e9 important d'introduire bri\u00e8vement cette construction ici."]}, {"block": 38, "type": "markdown", "linesLength": 1, "startIndex": 73, "lines": ["Le principe de l'op\u00e9rateur % est le suivant. On \u00e9labore comme ci-dessus un \"format\" c'est-\u00e0-dire le patron de ce qui doit \u00eatre rendu, auquel on passe des arguments pour \"remplir\" les trous. Voyons les exemples de tout \u00e0 l'heure rendus avec l'op\u00e9rateur `%`"]}, {"block": 39, "type": "code", "linesLength": 3, "startIndex": 74, "lines": ["# l'ancienne fa\u00e7on de formatter les cha\u00eenes avec %\n", "# est souvent moins lisible\n", "\"%s, %s, %sans\" % (nom, prenom, age)"]}, {"block": 40, "type": "markdown", "linesLength": 3, "startIndex": 77, "lines": ["Les personnes ayant \u00e9t\u00e9 expos\u00e9es \u00e0 C et C++ verront d'o\u00f9 venait cette conception des formats. Reconnaissons toutefois que le code en question n'est pas tr\u00e8s lisible, dans l'exemple ci-dessus on peut avoir du mal \u00e0 analyser le terme `sans` qui appara\u00eet \u00e0 premi\u00e8re vue comme un mot \u00e0 afficher. \n", "\n", "Quoi qu'il en soit, on pouvait \u00e9galement avec cet op\u00e9rateur recourir \u00e0 un m\u00e9canisme de liaison par nommage, en passant par un dictionnaire. Pour anticiper un tout petit peu sur cette notion que nous verrons tr\u00e8s bient\u00f4t, voici comment:"]}, {"block": 41, "type": "code", "linesLength": 2, "startIndex": 80, "lines": ["variables =  {'le_nom' : nom, 'le_prenom' : prenom, 'l_age' : age}\n", "\"%(le_nom)s, %(le_prenom)s, %(l_age)sans\" % variables"]}, {"block": 42, "type": "markdown", "linesLength": 1, "startIndex": 82, "lines": ["## Compl\u00e9ment - niveau avanc\u00e9"]}, {"block": 43, "type": "markdown", "linesLength": 1, "startIndex": 83, "lines": ["De retour \u00e0 la fonction `format`, il arrive qu'on ait besoin de sp\u00e9cifier plus finement la fa\u00e7on dont une valeur doit \u00eatre affich\u00e9e."]}, {"block": 44, "type": "markdown", "linesLength": 1, "startIndex": 84, "lines": ["### Pr\u00e9cision des arrondis"]}, {"block": 45, "type": "markdown", "linesLength": 1, "startIndex": 85, "lines": ["C'est typiquement le cas avec les valeurs flottantes, pour lesquelles la pr\u00e9cision avec laquelle on les montre vient au d\u00e9triment de la lisibilit\u00e9. Voici deux formes \u00e9quivalentes pour obtenir une valeur de pi arrondie&nbsp;:"]}, {"block": 46, "type": "code", "linesLength": 1, "startIndex": 86, "lines": ["from math import pi"]}, {"block": 47, "type": "code", "linesLength": 3, "startIndex": 87, "lines": ["# le plus simple\n", "\"pi avec seulement 2 chiffres apres la virgule {:.2f}\"\\\n", "    .format(pi)"]}, {"block": 48, "type": "code", "linesLength": 3, "startIndex": 90, "lines": ["# liaison par nom\n", "\"pi avec seulement 3 chiffres apres la virgule {flottant:.3f}\"\\\n", "    .format(flottant=pi)"]}, {"block": 49, "type": "markdown", "linesLength": 1, "startIndex": 93, "lines": ["### Largeur fixe"]}, {"block": 50, "type": "markdown", "linesLength": 1, "startIndex": 94, "lines": ["Dans certains cas on a besoin d'afficher des donn\u00e9es en colonnes de largeurs fixes; `format` permet de le faire, et de justifier la valeur \u00e0 droite ou \u00e0 gauche dans la largeur impartie, par exemple comme ceci&nbsp;:"]}, {"block": 51, "type": "code", "linesLength": 10, "startIndex": 95, "lines": ["# les donn\u00e9es \u00e0 afficher\n", "comptes = [\n", " ('Apollin', 'Dupont', 127),\n", " ('Myrtille', 'Lamartine', 25432),\n", " ('Prune', 'Soc', 827465),\n", "]\n", "\n", "for prenom, nom, solde in comptes:\n", "    print(\"{prenom:<10} -- {nom:12} -- {solde:>8} \u20ac\"\\\n", "        .format(prenom=prenom, nom=nom, solde=solde))"]}, {"block": 52, "type": "markdown", "linesLength": 1, "startIndex": 105, "lines": ["### Voir aussi"]}, {"block": 53, "type": "markdown", "linesLength": 1, "startIndex": 106, "lines": ["Nous vous invitons \u00e0 vous reporter [\u00e0 la documentation de `format`](https://docs.python.org/2.7/library/string.html#formatstrings) pour plus de d\u00e9tails sur les formats disponibles, et notamment aux [nombreux exemples](https://docs.python.org/2.7/library/string.html#format-examples) qui y figurent."]}]