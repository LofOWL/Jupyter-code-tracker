[{"block": 0, "type": "markdown", "linesLength": 5, "startIndex": 0, "lines": ["<style>div.title-slide {    width: 100%;    display: flex;    flex-direction: row;            /* default value; can be omitted */    flex-wrap: nowrap;              /* default value; can be omitted */    justify-content: space-between;}</style><div class=\"title-slide\">\n", "<span style=\"float:left;\">Licence CC BY-NC-ND</span>\n", "<span>Thierry Parmentelat &amp; Arnaud Legout</span>\n", "<span><img src=\"media/both-logos-small-alpha.png\" style=\"display:inline\" /></span>\n", "</div>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 5, "lines": ["# Nouveaut\u00e9s de Python-3.7 dans `asyncio`"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 6, "lines": ["## Compl\u00e9ment - niveau interm\u00e9diaire"]}, {"block": 3, "type": "markdown", "linesLength": 3, "startIndex": 7, "lines": ["Comme on l'a signal\u00e9 au d\u00e9but de la semaine, `asyncio` a subi quelques modifications dans Python-3.7, que nous allons rapidement illustrer dans ce compl\u00e9ment.\n", "\n", "Nous verrons aussi par ailleurs une curiosit\u00e9 li\u00e9e \u00e0 la  version de "]}, {"block": 4, "type": "markdown", "linesLength": 1, "startIndex": 10, "lines": ["### Documentation"]}, {"block": 5, "type": "markdown", "linesLength": 7, "startIndex": 11, "lines": ["L'\u00e9volution la plus radicale est une refonte totale de la documentation. \n", "\n", "C'est une tr\u00e8s bonne nouvelle, car de ll'aveu m\u00eame de Guido van Rossum, la documentation en place pour les versions 3.5 et 3.6 \u00e9tait particuli\u00e8rement obscure; [voici comment il l'a annonc\u00e9](https://twitter.com/gvanrossum/status/1041889574052429826?lang=en)\u00a0:\n", "\n", "> Finally the asyncio docs are not an embarrassment to us all.\n", "\n", "Si vous avez d\u00e9j\u00e0 eu l'occasion de parcourir ces anciennes documentations, et que vous les avez trouv\u00e9es imbittables, sachez que vous n'\u00eates pas seul dans ce cas ;) Dans tous les cas je vous invite \u00e0 [parcourir la nouvelle version](https://docs.python.org/3/library/asyncio.html), qui a le m\u00e9rite d'apporter plus de r\u00e9ponses qu'elle ne soul\u00e8ve d'interrogations. Ce n'\u00e9tait pas vraiment le cas avant."]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 18, "lines": ["### Acc\u00e8s plus facile"]}, {"block": 7, "type": "markdown", "linesLength": 3, "startIndex": 19, "lines": ["Un certain nombre de changements ont \u00e9t\u00e9 apport\u00e9s \u00e0 la librairie pour en rendre l'acc\u00e8s plus facile. \n", "\n", "**XXX**"]}, {"block": 8, "type": "markdown", "linesLength": 1, "startIndex": 22, "lines": ["### Pas de changement de fond"]}, {"block": 9, "type": "markdown", "linesLength": 3, "startIndex": 23, "lines": ["Par ailleurs en terme de l'utilisation de la librairie, \n", "\n", "**XXX**"]}, {"block": 10, "type": "markdown", "linesLength": 5, "startIndex": 26, "lines": ["### `await` dans ipython-7\n", "\n", "Cette section ne s'applique pas *stricto sensu* \u00e0 Python-3.7, mais \u00e0 la version 7 de IPython.\n", "\n", "Le sujet, c'est ici encore de raccourcir le *boilerplate* n\u00e9cessaire pour faire tourner une coroutine."]}, {"block": 11, "type": "markdown", "linesLength": 1, "startIndex": 31, "lines": ["##### Python standard"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 32, "lines": ["Voici d'abord ce qui se passe avec l'interpr\u00e9teur Python standard\u00a0:"]}, {"block": 13, "type": "markdown", "linesLength": 14, "startIndex": 33, "lines": ["```\n", "$ python3\n", "Python 3.7.0 (default, Jun 29 2018, 20:14:27)\n", "[Clang 9.0.0 (clang-900.0.39.2)] on darwin\n", "Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n", ">>> import asyncio\n", ">>> async def foo(message, duree):\n", "...    await asyncio.sleep(duree)\n", "...    print(message)\n", "...\n", ">>> await(foo(\"hello\", 1))\n", "  File \"<stdin>\", line 1\n", "SyntaxError: 'await' outside function\n", "```"]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 47, "lines": ["La syntaxe de Python nous interdit en effet d'utiliser `await` en dehors du code d'une coroutine, on l'a vu dans une des vid\u00e9os."]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 48, "lines": ["##### IPython-7"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 49, "lines": ["Pour **simplifier encore** la mise en place de code asynchrone, depuis ipython-7, on peut carr\u00e9ment d\u00e9clencher une coroutine en invoquant `await` dans la boucle principale de l'interpr\u00e9teur :"]}, {"block": 17, "type": "markdown", "linesLength": 20, "startIndex": 50, "lines": ["```\n", "$ ipython3\n", "Python 3.7.0 (default, Jun 29 2018, 20:14:27)\n", "Type 'copyright', 'credits' or 'license' for more information\n", "IPython 7.0.1 -- An enhanced Interactive Python. Type '?' for help.\n", "\n", "In [1]: import asyncio\n", "\n", "In [2]: async def foo(message, duree):\n", "   ...:     await asyncio.sleep(duree)\n", "   ...:     print(message)\n", "\n", "In [3]: await(foo(\"hello\", 0.5))\n", "hello\n", "\n", "In [4]: await(asyncio.gather(foo(\"hello\", 0.5), foo(\"world\", 1)))\n", "hello\n", "world\n", "Out[4]: [None, None]\n", "```"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 70, "lines": ["Du coup cette fa\u00e7on de faire fonctionnera aussi dans un notebook, si vous avez la bonne version de IPython en dessous de Jupyter."]}, {"block": 19, "type": "markdown", "linesLength": 3, "startIndex": 71, "lines": ["### Pour en savoir plus\n", "\n", "https://docs.python.org/3/whatsnew/3.7.html#whatsnew37-asyncio"]}]