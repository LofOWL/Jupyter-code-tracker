[{"block": 0, "type": "markdown", "linesLength": 1, "startIndex": 0, "lines": ["<span style=\"float:left;\">Licence CC BY-NC-ND</span><span style=\"float:right;\">Thierry Parmentelat &amp; Arnaud Legout&nbsp;<img src=\"media/both-logos-small-alpha.png\" style=\"display:inline\"></span><br/>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 1, "lines": ["# Les fonctions `globals` et `locals`"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 2, "lines": ["## Compl\u00e9ment - niveau interm\u00e9diaire"]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 3, "lines": ["### Un exemple"]}, {"block": 4, "type": "markdown", "linesLength": 3, "startIndex": 4, "lines": ["python fournit un acc\u00e8s \u00e0 la liste des noms et valeurs des variables visibles \u00e0 cet endroit du code. Dans le jargon des langages de programmation on appelle ceci **l'environnement**.\n", "\n", "Cela est fait gr\u00e2ce aux fonctions *builtin* `globals` et `locals`, que nous allons commencer par essayer sur quelques exemples. Nous avons pour cela \u00e9crit un module d\u00e9di\u00e9:"]}, {"block": 5, "type": "code", "linesLength": 1, "startIndex": 7, "lines": ["import env_locals_globals"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 8, "lines": ["Dont voici le code"]}, {"block": 7, "type": "code", "linesLength": 2, "startIndex": 9, "lines": ["from modtools import show_module\n", "show_module(env_locals_globals)"]}, {"block": 8, "type": "markdown", "linesLength": 1, "startIndex": 11, "lines": ["et voici ce qu'on obtient lorsqu'on appelle "]}, {"block": 9, "type": "code", "linesLength": 1, "startIndex": 12, "lines": ["env_locals_globals.temoin(10)"]}, {"block": 10, "type": "markdown", "linesLength": 1, "startIndex": 13, "lines": ["### Interpr\u00e9tation"]}, {"block": 11, "type": "markdown", "linesLength": 5, "startIndex": 14, "lines": ["Que nous montre cet exemple ?\n", "\n", "* D'une part la fonction **`globals`** nous donne la liste des symboles d\u00e9finis au niveau de **l'espace de noms du module**. Il s'agit \u00e9videmment du module dans lequel est d\u00e9finie la fonction, pas celui dans lequel elle est appel\u00e9e. Vous remarquerez que ceci englobe **tous** les symboles du module `env_locals_globals`, et non pas seulement ceux d\u00e9finis avant `temoin`, c'est-\u00e0-dire la variable `globale`, les deux fonctions `display_env` et `temoin`, et la classe `Foo`. \n", "\n", "* D'autre part **`locals`** nous donne les variables locales qui sont accessibles **\u00e0 cet endroit du code**, comme le montre ce second exemple qui se concentre sur `locals` \u00e0 diff\u00e9rents points d'une m\u00eame fonction. "]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 19, "lines": ["import env_locals"]}, {"block": 13, "type": "code", "linesLength": 2, "startIndex": 20, "lines": ["# le code de ce module \n", "show_module(env_locals)"]}, {"block": 14, "type": "code", "linesLength": 1, "startIndex": 22, "lines": ["env_locals.temoin(10)"]}, {"block": 15, "type": "markdown", "linesLength": 4, "startIndex": 23, "lines": ["xxx envisager de \n", "* ajouter une instrumentation apr\u00e8s le `for` pour montrer que i et j fuitent\n", "* ajouter une instrumentation avec un usage de global/nonlocal ?\n", "  c'est pour \u00e7a que je mets dans w4-s5 mais sinon \u00e7a peut bouger dans w4-s4"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 27, "lines": ["### Usage pour le formatage de cha\u00eenes"]}, {"block": 17, "type": "markdown", "linesLength": 1, "startIndex": 28, "lines": ["Ces deux fonctions ne sont pas d'une utilisation tr\u00e8s fr\u00e9quente. Elles peuvent cependant \u00eatre utiles dans le contexte du formatage de cha\u00eenes, comme on peut le voir dans les deux exemples ci-dessous."]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 29, "lines": ["**NOTE**: si vous pouvez \u00eatre s\u00fbr de disposer d'une version au moins sup\u00e9rieure \u00e0 python-3.6, alors les *f-strings* vous donnent une alternative bien plus \u00e9l\u00e9gante que ce que nous allons voir. "]}, {"block": 19, "type": "markdown", "linesLength": 1, "startIndex": 30, "lines": ["##### Avec `format`"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 31, "lines": ["On peut utiliser `format` qui s'attend \u00e0 quelque chose comme:"]}, {"block": 21, "type": "code", "linesLength": 1, "startIndex": 32, "lines": ["\"{nom}\".format(nom=\"Dupont\")"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 33, "lines": ["que l'on peut obtenir de mani\u00e8re \u00e9quivalente, avec le passage d'arguments en `**`, comme on l'a vu en fin de semaine pass\u00e9e:"]}, {"block": 23, "type": "code", "linesLength": 1, "startIndex": 34, "lines": ["\"{nom}\".format(**{'nom': 'Dupont'})"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 35, "lines": ["En versant la fonction `locals` dans cette formule on obtient une forme relativement \u00e9l\u00e9gante"]}, {"block": 25, "type": "code", "linesLength": 4, "startIndex": 36, "lines": ["def format_et_locals(nom, prenom, civilite, telephone):\n", "    return \"{civilite} {prenom} {nom} : Poste {telephone}\".format(**locals())\n", "\n", "format_et_locals('Dupont', 'Jean', 'Mr', '7748')"]}, {"block": 26, "type": "markdown", "linesLength": 1, "startIndex": 40, "lines": ["##### Avec l'op\u00e9rateur `%`"]}, {"block": 27, "type": "markdown", "linesLength": 1, "startIndex": 41, "lines": ["De mani\u00e8re similaire, avec l'op\u00e9rateur `%` - dont nous rappelons qu'il est obsol\u00e8te - on peut \u00e9crire"]}, {"block": 28, "type": "code", "linesLength": 4, "startIndex": 42, "lines": ["def pourcent_et_locals(nom, prenom, civilite, telephone):\n", "    return \"%(civilite)s %(prenom)s %(nom)s : Poste %(telephone)s\"%locals()\n", "\n", "pourcent_et_locals('Dupont', 'Jean', 'Mr', '7748')"]}, {"block": 29, "type": "markdown", "linesLength": 1, "startIndex": 46, "lines": ["##### Avec un *f-string*"]}, {"block": 30, "type": "markdown", "linesLength": 1, "startIndex": 47, "lines": ["Pour rappel si vous disposez de python 3.6, vous pouvez alors \u00e9crire simplement - et sans avoir recours, donc, \u00e0 `locals()` ou autre:"]}, {"block": 31, "type": "code", "linesLength": 5, "startIndex": 48, "lines": ["# attention ceci n\u00e9cessite python-3.6\n", "def avec_f_string(nom, prenom, civilite, telephone):\n", "    return f\"{civilite} {prenom} {nom} : Poste {telephone}\"\n", "\n", "avec_f_string('Dupont', 'Jean', 'Mr', '7748')"]}]