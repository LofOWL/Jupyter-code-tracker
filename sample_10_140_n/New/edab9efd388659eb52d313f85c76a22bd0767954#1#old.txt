[{"block": 0, "type": "markdown", "linesLength": 1, "startIndex": 0, "lines": ["## Testing transforms.py"]}, {"block": 1, "type": "code", "linesLength": 9, "startIndex": 1, "lines": ["%reload_ext autoreload\n", "%autoreload 2\n", "%matplotlib inline\n", "\n", "# This file contains all the main external libs we'll use\n", "from fastai.imports import *\n", "from fastai.transforms import *\n", "from fastai.plots import *\n", "from fastai.dataset import *"]}, {"block": 2, "type": "code", "linesLength": 2, "startIndex": 10, "lines": ["PATH = \"data/fish/\"\n", "PATH = \"/data2/yinterian/fisheries-kaggle/\""]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 12, "lines": ["### Fish with bounding box"]}, {"block": 4, "type": "code", "linesLength": 1, "startIndex": 13, "lines": ["fnames,corner_labels,_,_ = parse_csv_labels(f'{PATH}trn_bb_corners_labels', skip_header=False)"]}, {"block": 5, "type": "code", "linesLength": 4, "startIndex": 14, "lines": ["def get_x(f):\n", "    file_path = f'{PATH}/images/{f}'\n", "    im = PIL.Image.open(file_path).convert('RGB')\n", "    return im"]}, {"block": 6, "type": "code", "linesLength": 4, "startIndex": 18, "lines": ["f = 'img_02642.jpg'\n", "x = get_x(f)\n", "y = np.array(corner_labels[f], dtype=np.float32)\n", "y"]}, {"block": 7, "type": "code", "linesLength": 1, "startIndex": 22, "lines": ["x.size"]}, {"block": 8, "type": "code", "linesLength": 2, "startIndex": 23, "lines": ["rows = np.rint([y[0], y[0], y[2], y[2]]).astype(int)\n", "rows"]}, {"block": 9, "type": "code", "linesLength": 2, "startIndex": 25, "lines": ["cols = np.rint([y[1], y[3], y[1], y[3]]).astype(int)\n", "cols"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 27, "lines": ["corner_labels[\"img_02642.jpg\"]"]}, {"block": 11, "type": "code", "linesLength": 9, "startIndex": 28, "lines": ["def create_corner_rect(bb, color='red'):\n", "    bb = np.array(bb, dtype=np.float32)\n", "    return plt.Rectangle((bb[1], bb[0]), bb[3]-bb[1], bb[2]-bb[0], color=color, fill=False, lw=3)\n", "\n", "def show_corner_bb(f='img_04908.jpg'):\n", "    file_path = f'{PATH}images/{f}'\n", "    bb = corner_labels[f]\n", "    plots_from_files([file_path])\n", "    plt.gca().add_patch(create_corner_rect(bb))"]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 37, "lines": ["show_corner_bb(f = 'img_02642.jpg')"]}, {"block": 13, "type": "code", "linesLength": 2, "startIndex": 38, "lines": ["def get_x(self, i):\n", "    return PIL.Image.open(file_path)"]}, {"block": 14, "type": "code", "linesLength": 6, "startIndex": 40, "lines": ["def create_rect(bb, color='red'):\n", "    return plt.Rectangle((bb[1], bb[0]), bb[3]-bb[1], bb[2]-bb[0], color=color, fill=False, lw=3)\n", "\n", "def plotXY(x,y):\n", "    plots([x])\n", "    plt.gca().add_patch(create_rect(y))"]}, {"block": 15, "type": "code", "linesLength": 1, "startIndex": 46, "lines": ["plotXY(x,y)"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 47, "lines": ["## Scale"]}, {"block": 17, "type": "code", "linesLength": 1, "startIndex": 48, "lines": ["xx, yy = ScaleXY(sz=350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 18, "type": "code", "linesLength": 1, "startIndex": 49, "lines": ["plotXY(xx,yy)"]}, {"block": 19, "type": "code", "linesLength": 2, "startIndex": 50, "lines": ["xx, yy = ScaleXY(sz=350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 52, "lines": ["## RandomScale"]}, {"block": 21, "type": "code", "linesLength": 1, "startIndex": 53, "lines": ["xx, yy = RandomScaleXY(sz=350, max_zoom=1.1, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 22, "type": "code", "linesLength": 1, "startIndex": 54, "lines": ["plotXY(xx,yy)"]}, {"block": 23, "type": "code", "linesLength": 2, "startIndex": 55, "lines": ["xx, yy = RandomScaleXY(sz=350, max_zoom=1.1, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 57, "lines": ["## RandomCrop"]}, {"block": 25, "type": "code", "linesLength": 1, "startIndex": 58, "lines": ["xx, yy = RandomCropXY(targ=350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 26, "type": "code", "linesLength": 1, "startIndex": 59, "lines": ["plotXY(xx,yy)"]}, {"block": 27, "type": "code", "linesLength": 2, "startIndex": 60, "lines": ["xx, yy = RandomCropXY(350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 28, "type": "markdown", "linesLength": 1, "startIndex": 62, "lines": ["## No Cropping"]}, {"block": 29, "type": "code", "linesLength": 1, "startIndex": 63, "lines": ["xx, yy = NoCropXY(350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 30, "type": "code", "linesLength": 2, "startIndex": 64, "lines": ["print(yy)\n", "plotXY(xx,yy)"]}, {"block": 31, "type": "code", "linesLength": 2, "startIndex": 66, "lines": ["xx, yy = NoCropXY(350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 32, "type": "markdown", "linesLength": 1, "startIndex": 68, "lines": ["## CenterCrop"]}, {"block": 33, "type": "code", "linesLength": 1, "startIndex": 69, "lines": ["xx, yy = CenterCropXY(350, tfm_y=TfmType.COORD)(x, y)"]}, {"block": 34, "type": "code", "linesLength": 1, "startIndex": 70, "lines": ["plotXY(xx,yy)"]}, {"block": 35, "type": "code", "linesLength": 2, "startIndex": 71, "lines": ["xx, yy = CenterCropXY(350, tfm_y=TfmType.PIXEL)(x, x)\n", "plots([xx, yy])"]}, {"block": 36, "type": "markdown", "linesLength": 1, "startIndex": 73, "lines": ["## Random Dihedral"]}, {"block": 37, "type": "code", "linesLength": 1, "startIndex": 74, "lines": ["xx, yy = RandomDihedralXY(TfmType.COORD)(x, y)"]}, {"block": 38, "type": "code", "linesLength": 1, "startIndex": 75, "lines": ["print(yy)"]}, {"block": 39, "type": "code", "linesLength": 1, "startIndex": 76, "lines": ["plotXY(xx,yy)"]}, {"block": 40, "type": "code", "linesLength": 1, "startIndex": 77, "lines": ["xx, yy = RandomDihedralXY(tfm_y=TfmType.PIXEL)(x, x)"]}, {"block": 41, "type": "code", "linesLength": 1, "startIndex": 78, "lines": ["plots([xx,yy])"]}, {"block": 42, "type": "markdown", "linesLength": 1, "startIndex": 79, "lines": ["## RandomFlipXY"]}, {"block": 43, "type": "code", "linesLength": 3, "startIndex": 80, "lines": ["xx, yy = RandomFlipXY(TfmType.COORD)(x, y)\n", "print(yy)\n", "plotXY(xx,yy)"]}, {"block": 44, "type": "code", "linesLength": 2, "startIndex": 83, "lines": ["xx, yy = RandomFlipXY(TfmType.PIXEL)(x, x)\n", "plots([xx,yy])"]}, {"block": 45, "type": "markdown", "linesLength": 1, "startIndex": 85, "lines": ["## RandomLightingXY (talk to Jeremy about this)"]}, {"block": 46, "type": "code", "linesLength": 2, "startIndex": 86, "lines": ["xx, yy = RandomLightingXY(0.5, 0.5)(x, y)\n", "plotXY(xx,yy)"]}, {"block": 47, "type": "code", "linesLength": 3, "startIndex": 88, "lines": ["# talk to Jeremy about this\n", "xx, yy = RandomLightingXY(0.5, 0.5, TfmType.PIXEL)(x, x)\n", "plots([xx,yy])"]}, {"block": 48, "type": "markdown", "linesLength": 1, "startIndex": 91, "lines": ["## RandomRotate"]}, {"block": 49, "type": "code", "linesLength": 2, "startIndex": 92, "lines": ["xx, yy = RandomRotateXY(deg=30, p=1, tfm_y=TfmType.COORD)(x, y)\n", "plotXY(xx,yy)"]}, {"block": 50, "type": "code", "linesLength": 2, "startIndex": 94, "lines": ["xx, yy = RandomRotateXY(130,p=1.0, tfm_y=TfmType.COORD)(x, y)\n", "plotXY(xx,yy)"]}, {"block": 51, "type": "code", "linesLength": 1, "startIndex": 96, "lines": ["y"]}, {"block": 52, "type": "code", "linesLength": 2, "startIndex": 97, "lines": ["xx, yy = RandomRotateXY(0.5, 0.5, TfmType.PIXEL)(x, x)\n", "plots([xx,yy])"]}, {"block": 53, "type": "code", "linesLength": 0, "startIndex": 99, "lines": []}]