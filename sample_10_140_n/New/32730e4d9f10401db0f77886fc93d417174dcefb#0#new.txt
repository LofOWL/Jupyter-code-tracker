[{"block": 0, "type": "markdown", "linesLength": 5, "startIndex": 0, "lines": ["# Introduction: Plotting with Plotly + Cufflinks in Python\n", "\n", "In this notebook, we will see how to use [plotly](https://plot.ly/python/) and [cufflinks](https://github.com/santosjorge/cufflinks) to create interactive stunning figures in Python. This combination of libraries is extremely powerful and, in my opinion, much more efficient than other methods of plotting in Python.\n", "\n", "We'll stick mostly to basic graphs, focusing on what we can do in one line of code (for the most part). Before you get started, you'll want to head to [Plotly](https://help.plot.ly/how-to-sign-up-to-plotly/#step-1-create-your-free-account) and create an account to get a username and api key. Then run the cell below. "]}, {"block": 1, "type": "markdown", "linesLength": 3, "startIndex": 5, "lines": ["    import plotly \n", "    # Replace with your information\n", "    plotly.tools.set_credentials_file(username='DemoAccount', api_key='lr1c37zw81')"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 8, "lines": ["The Plotly Python library is an open-source version of the [Plotly](https://plot.ly/) visualization software made by Plotly. You can create a free account and upload your graphs to share with others (this requires making the graphs and data public). We will run plotly completely in offline mode which means that we won't be publishing any of our graphs online. However, we can still open up any of the plots in the Plotly [chart studio](https://plot.ly/create/#/) and edit them for a presentation. "]}, {"block": 3, "type": "code", "linesLength": 17, "startIndex": 9, "lines": ["# Data science imports\n", "import pandas as pd\n", "import numpy as np\n", "\n", "# Options for pandas\n", "pd.options.display.max_columns = 30\n", "\n", "# Display all cell outputs\n", "from IPython.core.interactiveshell import InteractiveShell\n", "InteractiveShell.ast_node_interactivity = 'all'\n", "\n", "# plotly standard imports\n", "import plotly.plotly as py\n", "import plotly.graph_objs as go\n", "\n", "# Cufflinks wrapper on plotly\n", "import cufflinks"]}, {"block": 4, "type": "markdown", "linesLength": 1, "startIndex": 26, "lines": ["We'll be using plotly + cufflinks in offline mode. We will also set the global `cufflinks` theme to `pearl`. Later we'll take a look at the other theme options."]}, {"block": 5, "type": "code", "linesLength": 5, "startIndex": 27, "lines": ["from plotly.offline import iplot\n", "cufflinks.go_offline()\n", "\n", "# Set global them\n", "cufflinks.set_config_file(world_readable=True, theme='pearl')"]}, {"block": 6, "type": "markdown", "linesLength": 3, "startIndex": 32, "lines": ["### Data\n", "\n", "We are using my medium article statistics data. See [this article](https://towardsdatascience.com/analyzing-medium-story-stats-with-python-24c6491a8ff0) for how to use your own Medium data! "]}, {"block": 7, "type": "code", "linesLength": 2, "startIndex": 35, "lines": ["df = pd.read_parquet('data/medium_data_2019_01_06')\n", "df.head()"]}, {"block": 8, "type": "markdown", "linesLength": 1, "startIndex": 37, "lines": ["# Univariate (Single Variable) Distributions"]}, {"block": 9, "type": "markdown", "linesLength": 1, "startIndex": 38, "lines": ["## Histograms"]}, {"block": 10, "type": "code", "linesLength": 7, "startIndex": 39, "lines": ["df['claps'].iplot(\n", "    kind='hist',\n", "    bins=30,\n", "    xTitle='claps',\n", "    linecolor='black',\n", "    yTitle='count',\n", "    title='Claps Distribution')"]}, {"block": 11, "type": "markdown", "linesLength": 1, "startIndex": 46, "lines": ["### Percentage Histogram"]}, {"block": 12, "type": "code", "linesLength": 8, "startIndex": 47, "lines": ["df['claps'].iplot(\n", "    kind='hist',\n", "    bins=30,\n", "    xTitle='claps',\n", "    linecolor='black',\n", "    histnorm='percent',\n", "    yTitle='percentage (%)',\n", "    title='Claps Distribution in Percent')"]}, {"block": 13, "type": "markdown", "linesLength": 1, "startIndex": 55, "lines": ["## Grouped Histogram"]}, {"block": 14, "type": "code", "linesLength": 2, "startIndex": 56, "lines": ["def to_time(dt):\n", "    return dt.hour + dt.minute / 60"]}, {"block": 15, "type": "code", "linesLength": 14, "startIndex": 58, "lines": ["df['time_started'] = df['started_date'].apply(to_time)\n", "df['time_published'] = df['published_date'].apply(to_time)\n", "\n", "df[['time_started', 'time_published']].iplot(\n", "    kind='hist',\n", "    linecolor='black',\n", "    bins=24,\n", "    histnorm='percent',\n", "    bargap=0.1,\n", "    opacity=0.8,\n", "    barmode='group',\n", "    xTitle='Time of Day',\n", "    yTitle='(%) of Articles',\n", "    title='Time Started and Time Published')"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 72, "lines": ["## Overlaid Histogram"]}, {"block": 17, "type": "code", "linesLength": 10, "startIndex": 73, "lines": ["df[['time_published', 'time_started']].iplot(\n", "    kind='hist',\n", "    bins=48,\n", "    linecolor='black',\n", "    opacity=0.8,\n", "    histnorm='percent',\n", "    barmode='overlay',\n", "    xTitle='Time of day',\n", "    yTitle='(%) of articles',\n", "    title='Time Started and Time Published Overlaid')"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 83, "lines": ["## Bar Plot"]}, {"block": 19, "type": "code", "linesLength": 4, "startIndex": 84, "lines": ["df.groupby('publication').count().iloc[:, 0].iplot(\n", "    kind='bar',\n", "    yTitle='Number of Articles',\n", "    title='Articles by Publication')"]}, {"block": 20, "type": "code", "linesLength": 7, "startIndex": 88, "lines": ["df[[c for c in df if '<tag>' in c]].sum().iplot(\n", "    kind='bar',\n", "    xTitle='Tag',\n", "    yTitle='Number of Articles',\n", "    title='Number of Articles by Tag',\n", "    linecolor='black',\n", "    sortbars=True)"]}, {"block": 21, "type": "code", "linesLength": 8, "startIndex": 95, "lines": ["df2 = df[['views', 'reads',\n", "          'published_date']].copy().set_index('published_date').resample('M')\n", "\n", "df2.mean().iplot(\n", "    kind='bar',\n", "    xTitle='Date',\n", "    yTitle='Average',\n", "    title='Monthly Average Views and Reads')"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 103, "lines": ["## Second Y-Axis"]}, {"block": 23, "type": "code", "linesLength": 10, "startIndex": 104, "lines": ["df2 = df[['views', 'reads',\n", "          'published_date']].copy().set_index('published_date').resample('M')\n", "\n", "df2.mean().iplot(\n", "    kind='bar',\n", "    xTitle='Date',\n", "    secondary_y='reads',\n", "    secondary_y_title='Views',\n", "    yTitle='Average Views',\n", "    title='Monthly Averages')"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 114, "lines": ["## Boxplot"]}, {"block": 25, "type": "code", "linesLength": 1, "startIndex": 115, "lines": ["df[['claps', 'fans']].iplot(kind='box', yTitle='Number', title='Box Plot of Claps and Fans')"]}, {"block": 26, "type": "markdown", "linesLength": 1, "startIndex": 116, "lines": ["### Boxplot with Different Categories"]}, {"block": 27, "type": "code", "linesLength": 9, "startIndex": 117, "lines": ["df.pivot(\n", "    columns='publication', values='fans').iplot(\n", "        kind='box',\n", "        xTitle='publication',\n", "        layout=dict(\n", "            yaxis=dict(title='claps'),\n", "            title='Claps by Publication',\n", "            margin=dict(b=140)),\n", "        theme='white')"]}, {"block": 28, "type": "code", "linesLength": 2, "startIndex": 126, "lines": ["df[df['read_time'] <= 10].pivot(columns='read_time', values='reads').iplot(kind='box', xTitle='Read Time', \n", "                                                                          yTitle='Number of Reads', title='Box Plot of Views by Reading Time')"]}, {"block": 29, "type": "markdown", "linesLength": 1, "startIndex": 128, "lines": ["cufflinks.themes.THEMES.keys()"]}, {"block": 30, "type": "markdown", "linesLength": 3, "startIndex": 129, "lines": ["# Scatter Plots\n", "\n", "The scatter plot is a simple yet effective method for visualizing the relationship between two variables. There are many ways we can make scatterplots in plotly + cufflinks."]}, {"block": 31, "type": "markdown", "linesLength": 1, "startIndex": 132, "lines": ["## Date Axis"]}, {"block": 32, "type": "code", "linesLength": 12, "startIndex": 133, "lines": ["tds = df[df['publication'] == 'Towards Data Science'].set_index('published_date')\n", "\n", "tds.iplot(\n", "    mode='lines+markers',\n", "    opacity=0.8,\n", "    size=8,\n", "    symbol=1,\n", "    xTitle='Date',\n", "    yTitle='Read Time (min)',\n", "    y='read_time',\n", "    text='title',\n", "    title='Read Time')"]}, {"block": 33, "type": "markdown", "linesLength": 1, "startIndex": 145, "lines": ["## Text Annotations on Plot"]}, {"block": 34, "type": "code", "linesLength": 12, "startIndex": 146, "lines": ["tds_monthly_totals = tds.resample('M').sum()\n", "text=[f'{m}<br>words: {w:.0f}' for m, w in zip(tds_monthly_totals.index.month_name(), tds_monthly_totals['word_count'])]\n", "\n", "tds_monthly_totals.iplot(\n", "    mode='lines+markers+text',\n", "    text=text,\n", "    y = 'word_count',\n", "    opacity=0.8,\n", "    theme='white',\n", "    xTitle='Date',\n", "    yTitle='Word Count',\n", "    title='Total Word Count by Month')"]}, {"block": 35, "type": "markdown", "linesLength": 1, "startIndex": 158, "lines": ["## Two Variables"]}, {"block": 36, "type": "code", "linesLength": 8, "startIndex": 159, "lines": ["tds.iplot(\n", "    x='word_count',\n", "    y='views',\n", "    xTitle='Word Count',\n", "    yTitle='views',\n", "    text='title',\n", "    mode='markers',\n", "    title='Views vs Word Count')"]}, {"block": 37, "type": "markdown", "linesLength": 1, "startIndex": 167, "lines": ["## Two Variables with Best Fit Line"]}, {"block": 38, "type": "code", "linesLength": 10, "startIndex": 168, "lines": ["tds.sort_values('word_count').iplot(\n", "    x='word_count',\n", "    y='views',\n", "    bestfit=True,\n", "    bestfit_colors=['blue'],\n", "    xTitle='Word Count',\n", "    yTitle='views',\n", "    text='title',\n", "    mode='markers',\n", "    title='Views vs Word Count')"]}, {"block": 39, "type": "code", "linesLength": 11, "startIndex": 178, "lines": ["tds.iplot(\n", "    y='views',\n", "    bestfit=True,\n", "    interpolation='linear',\n", "    bestfit_colors=['blue'],\n", "    xTitle='Date',\n", "    yTitle='views',\n", "    text='title',\n", "    mode='lines+markers',\n", "    size=8,\n", "    title='Views over Time with Best Fit Line')"]}, {"block": 40, "type": "markdown", "linesLength": 1, "startIndex": 189, "lines": ["## Log Scale"]}, {"block": 41, "type": "code", "linesLength": 12, "startIndex": 190, "lines": ["layout = dict(\n", "    xaxis=dict(type='log', title='Word Count'),\n", "    yaxis=dict(title='views'),\n", "    title='Views vs Word Count Log Axis')\n", "\n", "tds.sort_values('word_count').iplot(\n", "    x='word_count',\n", "    y='views',\n", "    layout=layout,\n", "    text='title',\n", "    mode='markers',\n", "bestfit=True, bestfit_colors=['blue'])"]}, {"block": 42, "type": "markdown", "linesLength": 1, "startIndex": 202, "lines": ["## Scatterplot By Category"]}, {"block": 43, "type": "code", "linesLength": 8, "startIndex": 203, "lines": ["df.pivot_table(\n", "    values='views', index='published_date', columns='publication').cumsum().iplot(\n", "        mode='markers+lines',\n", "        theme='white',\n", "        size=8, symbol=[1, 2, 3, 4, 5],\n", "        layout=dict(xaxis=dict(title='Date'),\n", "        yaxis=dict(type='log', title='Total Views'),\n", "        title='Total Views over Time by Publication'))"]}, {"block": 44, "type": "markdown", "linesLength": 4, "startIndex": 211, "lines": ["# More than 2 Variables\n", "\n", "We can expand to greater than 2 variables by encoding information in the colors, size of markers, or symbols. We can also use secondary y-axes for more information.\n", "\n"]}, {"block": 45, "type": "markdown", "linesLength": 1, "startIndex": 215, "lines": ["## Secondary Y-Axis"]}, {"block": 46, "type": "code", "linesLength": 4, "startIndex": 216, "lines": ["tds[['reads', 'read_ratio']].iplot(y='reads', secondary_y='read_ratio', xTitle='Date',\n", "                                   yTitle='Reads', secondary_y_title='Read Ratio',\n", "                                   mode='markers+lines',\n", "                                   title='Reads and Read Ratio over Time')"]}, {"block": 47, "type": "code", "linesLength": 4, "startIndex": 220, "lines": ["tds[['word_count', 'reads', 'read_ratio', 'title']].iplot(x='word_count', y='reads', secondary_y='read_ratio', xTitle='Word Count',\n", "                                   yTitle='Reads', secondary_y_title='Read Ratio',\n", "                                   mode='markers', size=10, text='title',\n", "                                   title='Reads and Read Ratio vs Number of Words')"]}, {"block": 48, "type": "markdown", "linesLength": 1, "startIndex": 224, "lines": ["## Three Variables with a Category"]}, {"block": 49, "type": "code", "linesLength": 6, "startIndex": 225, "lines": ["df.iplot(x = 'word_count', y = 'views', categories='publication',\n", "        mode='markers', text='title',\n", "        size=8,\n", "        layout=dict(xaxis=dict(title='Word Count'),\n", "        yaxis=dict(title='Views'),\n", "        title='Views vs Word Count by Publication'))"]}, {"block": 50, "type": "markdown", "linesLength": 1, "startIndex": 231, "lines": ["## Three Numeric Variables"]}, {"block": 51, "type": "code", "linesLength": 16, "startIndex": 232, "lines": ["text=[\n", "        f'Title: {t} <br> Ratio: {r:.2f}%'\n", "        for t, r in zip(tds['title'], tds['read_ratio'])\n", "    ]\n", "\n", "tds.iplot(\n", "    x='word_count',\n", "    y='reads',\n", "    opacity=0.8,\n", "    size=tds['read_ratio'],\n", "    text = text,\n", "    mode='markers',\n", "    layout=dict(\n", "        xaxis=dict(type='log', title='Word Count'),\n", "        yaxis=dict(title='Reads'),\n", "        title='Reads vs Log Word Count Sized by Read Ratio'))"]}, {"block": 52, "type": "markdown", "linesLength": 1, "startIndex": 248, "lines": ["## Four Variables"]}, {"block": 53, "type": "code", "linesLength": 5, "startIndex": 249, "lines": ["colorscales = [\n", "    'Greys', 'YlGnBu', 'Greens', 'YlOrRd', 'Bluered', 'RdBu', 'Reds', 'Blues',\n", "    'Picnic', 'Rainbow', 'Portland', 'Jet', 'Hot', 'Blackbody', 'Earth',\n", "    'Electric', 'Viridis', 'Cividis'\n", "]"]}, {"block": 54, "type": "code", "linesLength": 24, "startIndex": 254, "lines": ["data = [\n", "    go.Scatter(\n", "        x=df['word_count'],\n", "        y=df['reads'],\n", "        text=df['title'],\n", "        mode='markers',\n", "        marker=dict(\n", "            sizemin=10,\n", "            size=df['read_ratio'],\n", "            colorscale=colorscales[10],\n", "            showscale=True,\n", "            color=df['read_time'],\n", "            line=dict(color='black', width=1.2)))\n", "]\n", "\n", "figure = go.Figure(\n", "    data=data,\n", "    layout=go.Layout(\n", "        xaxis=dict(title='Word Count'),\n", "        yaxis=dict(title='Reads'),\n", "        title='Reads vs Word Count Colored by Read Time and Sized by Read Ratio'\n", "    ))\n", "\n", "iplot(figure)"]}, {"block": 55, "type": "markdown", "linesLength": 1, "startIndex": 278, "lines": ["## Five Variables"]}, {"block": 56, "type": "code", "linesLength": 1, "startIndex": 279, "lines": ["go.Layout()"]}, {"block": 57, "type": "code", "linesLength": 31, "startIndex": 280, "lines": ["data = [\n", "    go.Scatter(\n", "        x=grouped['word_count'],\n", "        y=grouped['reads'],\n", "        text=grouped['title'],\n", "        mode='markers',\n", "        name=name,\n", "        marker=dict(\n", "            symbol=i,\n", "            sizemin=2,\n", "            sizeref=2,\n", "            size=grouped['read_ratio'],\n", "            colorscale=colorscales[4],\n", "            showscale=True,\n", "            color=df['read_time'],\n", "            line=dict(color='black', width=1.2)))\n", "    for i, (name, grouped) in enumerate(df.groupby('publication'))\n", "]\n", "\n", "figure = go.Figure(\n", "    data=data,\n", "    layout=go.Layout(\n", "        legend=dict(x=1.2),\n", "        width=1000, \n", "        margin=dict(r=20),\n", "        xaxis=dict(type='log', title='Word Count'),\n", "        yaxis=dict(title='Reads'),\n", "        title='Reads vs Word Count Colored by Read Time, Sized by Read Ratio, and Shaped by Publication'\n", "    ))\n", "\n", "iplot(figure)"]}, {"block": 58, "type": "code", "linesLength": 1, "startIndex": 311, "lines": ["cufflinks.colors.scales()"]}, {"block": 59, "type": "markdown", "linesLength": 1, "startIndex": 312, "lines": ["# Scatter Matrix"]}, {"block": 60, "type": "code", "linesLength": 10, "startIndex": 313, "lines": ["import plotly.figure_factory as ff\n", "\n", "figure = ff.create_scatterplotmatrix(\n", "    df[['claps', 'publication', 'views', 'read_ratio', 'word_count']],\n", "    height=1000,\n", "    width=1000,\n", "    text=df['title'],\n", "    diag='histogram',\n", "    index='publication')\n", "iplot(figure)"]}, {"block": 61, "type": "markdown", "linesLength": 1, "startIndex": 323, "lines": ["# Heatmap"]}, {"block": 62, "type": "code", "linesLength": 15, "startIndex": 324, "lines": ["corrs = df.corr()\n", "\n", "figure = ff.create_annotated_heatmap(\n", "    z=corrs.values,\n", "    x=list(corrs.columns),\n", "    y=list(corrs.index),\n", "    colorscale=colorscales[5],\n", "    annotation_text=corrs.round(2).values,\n", "    showscale=True)\n", "\n", "figure.layout.margin = dict(l=200, t=200)\n", "figure.layout.height = 800\n", "figure.layout.width = 1000\n", "\n", "iplot(figure)"]}, {"block": 63, "type": "markdown", "linesLength": 1, "startIndex": 339, "lines": ["# Spread"]}, {"block": 64, "type": "code", "linesLength": 2, "startIndex": 340, "lines": ["df.set_index('published_date')[['views', 'reads']].iplot(\n", "    kind='spread', mode='markers', yTitle='Number', title='Spread between Views and Reads')"]}, {"block": 65, "type": "markdown", "linesLength": 17, "startIndex": 342, "lines": ["    kinds = \n", "               scatter\n", "               bar\n", "               box\n", "               spread\n", "               ratio\n", "               heatmap\n", "               surface\n", "               histogram\n", "               bubble\n", "               bubble3d\n", "               scatter3d       \n", "               scattergeo\n", "               ohlc\n", "               candle\n", "               pie\n", "               choroplet  "]}, {"block": 66, "type": "markdown", "linesLength": 1, "startIndex": 359, "lines": ["# Ratio"]}, {"block": 67, "type": "code", "linesLength": 2, "startIndex": 360, "lines": ["df.set_index('published_date')[['views', 'reads']].iplot(theme='pearl',\n", "    kind='ratio', title='Ratio of Views to Reads', mode='markers')"]}, {"block": 68, "type": "markdown", "linesLength": 1, "startIndex": 362, "lines": ["# Themes"]}, {"block": 69, "type": "code", "linesLength": 4, "startIndex": 363, "lines": ["themes = cufflinks.themes.THEMES.keys()\n", "for t in themes:\n", "    df.set_index('published_date')[['views', 'reads']].iplot(theme=t,\n", "    kind='ratio', title=f'{t} Theme', mode='markers')"]}, {"block": 70, "type": "markdown", "linesLength": 1, "startIndex": 367, "lines": ["# Pie Chart"]}, {"block": 71, "type": "code", "linesLength": 3, "startIndex": 368, "lines": ["df.groupby(\n", "    'publication', as_index=False)['reads'].count().iplot(\n", "        kind='pie', labels='publication', values='reads', title='Percentage of Reads by Publication')"]}, {"block": 72, "type": "code", "linesLength": 3, "startIndex": 371, "lines": ["df.groupby(\n", "    'publication', as_index=False)['word_count'].sum().iplot(\n", "        kind='pie', labels='publication', values='word_count', title='Percentage of Words by Publication')"]}, {"block": 73, "type": "code", "linesLength": 1, "startIndex": 374, "lines": ["cufflinks.colors.scales()"]}, {"block": 74, "type": "markdown", "linesLength": 1, "startIndex": 375, "lines": ["# 3D Surface Plot"]}, {"block": 75, "type": "code", "linesLength": 1, "startIndex": 376, "lines": ["df[['views', 'reads', 'read_ratio']].iplot(kind='surface', title='Surface Plot')"]}, {"block": 76, "type": "markdown", "linesLength": 1, "startIndex": 377, "lines": ["# 3D Scatter Plot"]}, {"block": 77, "type": "code", "linesLength": 3, "startIndex": 378, "lines": ["df.iplot(x='word_count', y='views', z='fans', kind='scatter3d', xTitle='Word Count', yTitle='Views',\n", "         zTitle='Fans', theme='pearl',\n", "         categories='type', title='3D Scatter Plot by Type')"]}, {"block": 78, "type": "markdown", "linesLength": 1, "startIndex": 381, "lines": ["# 3D Bubble Chart"]}, {"block": 79, "type": "code", "linesLength": 3, "startIndex": 382, "lines": ["df.iplot(x='word_count', y='views', z='fans', kind='bubble3d', xTitle='Word Count', yTitle='Views',\n", "         zTitle='Fans', theme='pearl', size='read_ratio',\n", "         categories='type', title='3D Bubble Plot Sized by Read Ratio and Colored by Type')"]}, {"block": 80, "type": "markdown", "linesLength": 3, "startIndex": 385, "lines": ["# Conclusions\n", "\n", "Hopefully you now have a little idea of the capabilties of plotly + cufflinks. We have only scrachted the surface of this library, so check out the [cufflinks documentation](https://github.com/santosjorge/cufflinks) and the [plotly documentation](https://plot.ly/python/) for plently of more examples."]}, {"block": 81, "type": "code", "linesLength": 11, "startIndex": 388, "lines": ["import pandas as pd\n", "import plotly.graph_objs as go\n", "import cufflinks\n", "cufflinks.go_offline()\n", "\n", "layout = go.Layout(xaxis=dict(type='date'))\n", "df = pd.read_parquet(\n", "    'https://github.com/WillKoehrsen/Data-Analysis/blob/master/plotly/data/medium_data_2019_01_06?raw=true'\n", ")\n", "\n", "df.iplot(kind='scatter', y='claps', x='published_date', mode='markers')"]}]