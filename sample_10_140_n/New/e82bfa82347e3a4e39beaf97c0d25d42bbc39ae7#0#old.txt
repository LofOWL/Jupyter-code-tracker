[{"block": 0, "type": "code", "linesLength": 2, "startIndex": 0, "lines": ["from fastai import *        # Quick accesss to most common functionality\n", "from fastai.text import *   # Quick accesss to NLP functionality"]}, {"block": 1, "type": "code", "linesLength": 2, "startIndex": 2, "lines": ["path = untar_data(URLs.IMDB_SAMPLE)\n", "path"]}, {"block": 2, "type": "code", "linesLength": 2, "startIndex": 4, "lines": ["def open_text(fn:PathOrStr):\n", "    with open(fn,'r') as f: return ''.join(f.readlines())"]}, {"block": 3, "type": "code", "linesLength": 11, "startIndex": 6, "lines": ["def _treat_html(o:str)->str:\n", "    return o.replace('\\n','\\\\n')\n", "\n", "def _text2html_table(items:Collection[Collection[str]], widths:Collection[int])->str:\n", "    html_code = f\"<table>\"\n", "    for w in widths: html_code += f\"  <col width='{w}%'>\"\n", "    for line in items:\n", "        html_code += \"  <tr>\\n\"\n", "        html_code += \"\\n\".join([f\"    <th>{_treat_html(o)}</th>\" for o in line if len(o) >= 1])\n", "        html_code += \"\\n  </tr>\\n\"\n", "    return html_code + \"</table>\\n\""]}, {"block": 4, "type": "code", "linesLength": 44, "startIndex": 17, "lines": ["class Text(ItemBase):\n", "    def __init__(self, ids, text): self.data,self.text = ids,text\n", "    def __str__(self):  return str(self.text)\n", "    \n", "    def show_batch(self, idxs:Collection[int], rows:int, ds:Dataset, figsize:Tuple[int,int]=(9,10))->None:\n", "        from IPython.display import display, HTML\n", "        items = [['text', 'label']]\n", "        for i in idxs[:rows]:\n", "            x,y = ds[i]\n", "            items.append([str(x), str(y)])\n", "        display(HTML(_text2html_table(items, [90,10])))\n", "\n", "class NumericalizedTextList(ItemList):\n", "    def __init__(self, items:Iterator, vocab:Vocab=None, create_func:Callable=None, path:PathOrStr='.', xtra=None):\n", "        super().__init__(items, create_func=create_func, path=path, xtra=xtra)\n", "        self.vocab = vocab\n", "        \n", "    def new(self, items:Iterator, xtra:Any=None)->'NumericalizedTextList':\n", "        return super().new(items=items, vocab=self.vocab, xtra=xtra)\n", "    \n", "    def get(self, i):\n", "        o = super().get(i)\n", "        return Text(o, self.vocab.textify(o))\n", "    \n", "class TokenizedTextList(NumericalizedTextList):\n", "    def preprocess(self, vocab:Vocab=None, max_vocab:int=60000, min_freq:int=2):\n", "        self.vocab = ifnone(vocab, Vocab.create(self.items, max_vocab, min_freq))\n", "        self.preprocess_kwargs = {'vocab': self.vocab}\n", "        self.items = np.array([self.vocab.numericalize(t) for t in self.items])\n", "    \n", "class TextList(TokenizedTextList):\n", "    def preprocess(self, tokenizer:Tokenizer=None, chunksize:int=10000, vocab:Vocab=None, \n", "                   max_vocab:int=60000, min_freq:int=2):\n", "        tokenizer = ifnone(tokenizer, Tokenizer())\n", "        tokens = []\n", "        for i in progress_bar(range(0,len(self.items),chunksize), leave=False):\n", "            tokens += tokenizer.process_all(self.items[i:i+chunksize])\n", "        self.items = tokens\n", "        super().preprocess(vocab, max_vocab, min_freq)\n", "    \n", "class TextFilesList(TextList):\n", "    def __init__(self, items:Iterator, create_func:Callable=None, path:PathOrStr='.'):\n", "        texts = [open_text(fn) for fn in items]\n", "        super().__init__(texts, create_func, path)"]}, {"block": 5, "type": "code", "linesLength": 4, "startIndex": 61, "lines": ["il = (TextList.from_csv(path, 'texts.csv', create_func=None, col='text')\n", "        .random_split_by_pct()\n", "        .label_from_df(cols=0)\n", "     )"]}, {"block": 6, "type": "code", "linesLength": 1, "startIndex": 65, "lines": ["sd = il.preprocess()"]}, {"block": 7, "type": "code", "linesLength": 1, "startIndex": 66, "lines": ["len(sd.valid.vocab.itos), len(sd.train.vocab.itos)"]}, {"block": 8, "type": "code", "linesLength": 2, "startIndex": 67, "lines": ["df = pd.read_csv(path/'texts.csv')\n", "df.head()"]}, {"block": 9, "type": "code", "linesLength": 1, "startIndex": 69, "lines": ["sd.valid"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 70, "lines": ["sd.add_test(df['text'].values)"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 71, "lines": ["len(sd.valid.vocab.itos), len(sd.train.vocab.itos), len(sd.test.vocab.itos)"]}, {"block": 12, "type": "code", "linesLength": 1, "startIndex": 72, "lines": ["data = sd.databunch()"]}, {"block": 13, "type": "code", "linesLength": 1, "startIndex": 73, "lines": ["data.show_batch()"]}, {"block": 14, "type": "code", "linesLength": 0, "startIndex": 74, "lines": []}]