[{"block": 0, "type": "markdown", "linesLength": 5, "startIndex": 0, "lines": ["<style>div.title-slide {    width: 100%;    display: flex;    flex-direction: row;            /* default value; can be omitted */    flex-wrap: nowrap;              /* default value; can be omitted */    justify-content: space-between;}</style><div class=\"title-slide\">\n", "<span style=\"float:left;\">Licence CC BY-NC-ND</span>\n", "<span>Thierry Parmentelat &amp; Arnaud Legout</span>\n", "<span><img src=\"media/both-logos-small-alpha.png\" style=\"display:inline\" /></span>\n", "</div>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 5, "lines": ["# Notions sur la pr\u00e9cision des calculs flottants"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 6, "lines": ["## Compl\u00e9ment - niveau avanc\u00e9"]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 7, "lines": ["### Le probl\u00e8me"]}, {"block": 4, "type": "markdown", "linesLength": 6, "startIndex": 8, "lines": ["Comme pour les entiers, les calculs sur les flottants sont, \n", "naturellement, r\u00e9alis\u00e9s par le processeur.\n", "Cependant contrairement au cas des entiers o\u00f9 \n", "les calculs sont toujours exacts, les flottants posent un \n", "probl\u00e8me de pr\u00e9cision. Cela n'est pas propre au langage python, mais \n", "est d\u00fb \u00e0 la technique de codage des nombres flottants sous forme binaire. "]}, {"block": 5, "type": "markdown", "linesLength": 1, "startIndex": 14, "lines": ["Voyons tout d'abord comment se mat\u00e9rialise le probl\u00e8me."]}, {"block": 6, "type": "code", "linesLength": 1, "startIndex": 15, "lines": ["0.2 + 0.4"]}, {"block": 7, "type": "markdown", "linesLength": 4, "startIndex": 16, "lines": ["Il faut retenir que lorsqu'on \u00e9crit un nombre flottant sous forme d\u00e9cimale,\n", "la valeur utilis\u00e9e en m\u00e9moire pour repr\u00e9senter ce nombre, parce que \n", "cette valeur est cod\u00e9e en binaire, ne repr\u00e9sente \n", "**pas toujours exactement** le nombre entr\u00e9."]}, {"block": 8, "type": "code", "linesLength": 2, "startIndex": 20, "lines": ["# du coup cette expression est fausse, \u00e0 cause de l'erreur d'arrondi\n", "0.3 - 0.1 == 0.2"]}, {"block": 9, "type": "markdown", "linesLength": 1, "startIndex": 22, "lines": ["Aussi comme on le voit les diff\u00e9rentes erreurs d'arrondi qui se produisent \u00e0 chaque \u00e9tape du calcul s'accumulent et produisent un r\u00e9sultat parfois surprenant. De nouveau, ce probl\u00e8me n'est pas sp\u00e9cifique \u00e0 python, il existe pour tous les langages et il est bien connu des num\u00e9riciens. "]}, {"block": 10, "type": "markdown", "linesLength": 2, "startIndex": 23, "lines": ["Dans une grande majorit\u00e9 des cas, ces erreurs d'arrondi ne sont pas p\u00e9nalisantes. \n", "Il faut toutefois en \u00eatre conscient car cela peut expliquer des comportements curieux. "]}, {"block": 11, "type": "markdown", "linesLength": 1, "startIndex": 25, "lines": ["### Une solution : penser en termes de nombres rationnels"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 26, "lines": ["Tout d'abord si votre probl\u00e8me se pose bien en termes de nombres rationnels, il est alors tout \u00e0 fait possible de le r\u00e9soudre avec exactitude."]}, {"block": 13, "type": "markdown", "linesLength": 1, "startIndex": 27, "lines": ["Alors qu'il n'est pas possible d'\u00e9crire exactement $3/10$ en base 2, ni d'ailleurs $1/3$ en base 10, on peut repr\u00e9senter **exactement** ces nombres d\u00e8s lors qu'on les consid\u00e8re comme des fractions et qu'on les encode avec deux nombres entiers."]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 28, "lines": ["Python fournit en standard le module `fractions` qui permet de r\u00e9soudre le probl\u00e8me. Voici comment on pourrait l'utiliser pour v\u00e9rifier, cette fois avec succ\u00e8s, que $0.3 - 0.1$ vaut bien $0.2$. Ce code anticipe sur l'utilisation des modules et des classes en Python, ici nous cr\u00e9ons des objets de type `Fraction`"]}, {"block": 15, "type": "code", "linesLength": 5, "startIndex": 29, "lines": ["# on importe le module fractions, qui lui-m\u00eame d\u00e9finit le symbole Fraction\n", "from fractions import Fraction\n", "\n", "# et cette fois, les calculs sont exacts, et l'expression retourne bien True\n", "Fraction(3, 10) - Fraction(1, 10) == Fraction(2, 10)"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 34, "lines": ["Ou encore d'ailleurs, \u00e9quivalent et plus lisible"]}, {"block": 17, "type": "code", "linesLength": 1, "startIndex": 35, "lines": ["Fraction('0.3') - Fraction('0.1') == Fraction('2/10')"]}, {"block": 18, "type": "markdown", "linesLength": 1, "startIndex": 36, "lines": ["### Une autre solution : le module decimal"]}, {"block": 19, "type": "markdown", "linesLength": 1, "startIndex": 37, "lines": ["Si par contre vous ne manipulez pas des nombres rationnels et que du coup la repr\u00e9sentation sous forme de fractions ne peut pas convenir dans votre cas, signalons l'existence du module standard `decimal` qui offre des fonctionnalit\u00e9s tr\u00e8s voisines du type `float`, tout en \u00e9liminant la plupart des inconv\u00e9nients, au prix naturellement d'une consommation m\u00e9moire sup\u00e9rieure."]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 38, "lines": ["Pour reprendre l'exemple de d\u00e9part, mais en utilisant le module decimal, on \u00e9crirait alors"]}, {"block": 21, "type": "code", "linesLength": 3, "startIndex": 39, "lines": ["from decimal import Decimal\n", "\n", "Decimal('0.3') - Decimal('0.1') == Decimal('0.2')"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 42, "lines": ["### Pour aller plus loin"]}, {"block": 23, "type": "markdown", "linesLength": 7, "startIndex": 43, "lines": ["Tous ces documents sont en anglais.\n", "\n", " * Un [tutoriel sur les nombres flottants](https://docs.python.org/3/tutorial/floatingpoint.html)\n", "\n", " * La [documentation sur la classe Fraction](https://docs.python.org/3/library/fractions.html)\n", " \n", " * La [documentation sur la classe Decimal](https://docs.python.org/3/library/decimal.html)"]}]