[{"block": 0, "type": "markdown", "linesLength": 5, "startIndex": 0, "lines": ["<style>div.title-slide {    width: 100%;    display: flex;    flex-direction: row;            /* default value; can be omitted */    flex-wrap: nowrap;              /* default value; can be omitted */    justify-content: space-between;}</style><div class=\"title-slide\">\n", "<span style=\"float:left;\">Licence CC BY-NC-ND</span>\n", "<span>Thierry Parmentelat &amp; Arnaud Legout</span>\n", "<span><img src=\"media/both-logos-small-alpha.png\" style=\"display:inline\" /></span>\n", "</div>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 5, "lines": ["# Passage d'arguments par r\u00e9f\u00e9rence"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 6, "lines": ["## Compl\u00e9ment - niveau interm\u00e9diaire"]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 7, "lines": ["Entre le code qui appelle une fonction et le code de la fonction elle-m\u00eame"]}, {"block": 4, "type": "code", "linesLength": 5, "startIndex": 8, "lines": ["def ma_fonction(dans_fonction):\n", "    print(dans_fonction)\n", "    \n", "dans_appelant = [\"texte\"]\n", "ma_fonction(dans_appelant)"]}, {"block": 5, "type": "markdown", "linesLength": 3, "startIndex": 13, "lines": ["on peut se demander quelle est exactement la nature de la relation entre l'appelant et l'appel\u00e9, c'est-\u00e0-dire ici `dans_appelant` et `dans_fonction`. \n", "\n", "C'est l'objet de ce compl\u00e9ment."]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 16, "lines": ["### Passage par valeur - passage par r\u00e9f\u00e9rence "]}, {"block": 7, "type": "markdown", "linesLength": 4, "startIndex": 17, "lines": ["Si vous avez appris d'autres langages de programmation comme C ou C++, on a pu vous parler de deux modes de passage de param\u00e8tres\u00a0:\n", "\n", " * par valeur\u00a0: cela signifie qu'on communique \u00e0 la fonction, non pas l'entit\u00e9 dans l'appelant, mais seulement **sa valeur**\u00a0; en clair, **une copie**\u00a0;\n", " * par r\u00e9f\u00e9rence\u00a0: cela signifie qu'on passe \u00e0 la fonction une **r\u00e9f\u00e9rence** \u00e0 l'argument dans l'appelant, donc essentiellement les deux codes **partagent** la m\u00eame m\u00e9moire."]}, {"block": 8, "type": "markdown", "linesLength": 1, "startIndex": 21, "lines": ["### Python fait du passage par r\u00e9f\u00e9rence"]}, {"block": 9, "type": "markdown", "linesLength": 1, "startIndex": 22, "lines": ["Certains langages comme Pascal - et C++ si on veut - proposent ces deux modes. En Python, tous les passages de param\u00e8tres se font **par r\u00e9f\u00e9rence**."]}, {"block": 10, "type": "code", "linesLength": 2, "startIndex": 23, "lines": ["# chargeons la magie pour pythontutor\n", "%load_ext ipythontutor"]}, {"block": 11, "type": "code", "linesLength": 6, "startIndex": 25, "lines": ["%%ipythontutor curInstr=4\n", "def ma_fonction(dans_fonction):\n", "    print(dans_fonction)\n", "    \n", "dans_appelant = [\"texte\"]\n", "ma_fonction(dans_appelant)"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 31, "lines": ["Ce qui signifie qu'on peut voir le code ci-dessus comme \u00e9tant - pour simplifier - \u00e9quivalent \u00e0 ceci\u00a0:"]}, {"block": 13, "type": "code", "linesLength": 6, "startIndex": 32, "lines": ["dans_appelant = [\"texte\"]\n", "\n", "# ma_fonction (dans_appelant)\n", "# \u2192 on entre dans la fonction\n", "dans_fonction = dans_appelant\n", "print(dans_fonction)"]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 38, "lines": ["On peut le voir encore d'une autre fa\u00e7on en instrumentant le code comme ceci -- on rappelle que la fonction built-in `id` retourne l'adresse m\u00e9moire d'un objet\u00a0:"]}, {"block": 15, "type": "code", "linesLength": 6, "startIndex": 39, "lines": ["def ma_fonction(dans_fonction):\n", "    print('dans ma_fonction', dans_fonction , id(dans_fonction))\n", "    \n", "dans_appelant = [\"texte\"]\n", "print('dans appelant   ', dans_appelant, id(dans_appelant))\n", "ma_fonction(dans_appelant)"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 45, "lines": ["### Des r\u00e9f\u00e9rences partag\u00e9es"]}, {"block": 17, "type": "markdown", "linesLength": 1, "startIndex": 46, "lines": ["On voit donc que l'appel de fonction cr\u00e9e des r\u00e9f\u00e9rences partag\u00e9es, exactement comme l'affectation, et que tout ce que nous avons vu au sujet des r\u00e9f\u00e9rences partag\u00e9es s'applique exactement \u00e0 l'identique\u00a0:"]}, {"block": 18, "type": "code", "linesLength": 7, "startIndex": 47, "lines": ["# on ne peut pas modifier un immuable dans une fonction\n", "def increment(n):\n", "    n += 1\n", "\n", "compteur = 10\n", "increment(compteur)\n", "print(compteur)"]}, {"block": 19, "type": "code", "linesLength": 7, "startIndex": 54, "lines": ["# on peut par contre ajouter dans une liste\n", "def insert(liste, valeur):\n", "    liste.append(valeur)\n", "    \n", "liste = [\"un\"]\n", "insert(liste, \"texte\")\n", "print(liste)"]}, {"block": 20, "type": "markdown", "linesLength": 3, "startIndex": 61, "lines": ["Pour cette raison, il est important de bien pr\u00e9ciser, quand vous documentez une fonction, si elle fait des effets de bord sur ses arguments (c'est-\u00e0-dire qu'elle modifie ses arguments), ou si elle produit une copie. Rappelez-vous par exemple le cas de la m\u00e9thode `sort` sur les listes, et de la fonction de commodit\u00e9 `sorted`, que nous avions vues en semaine 2.\n", "\n", "De cette fa\u00e7on, on saura s'il faut ou non copier l'argument avant de le passer \u00e0 votre fonction."]}]