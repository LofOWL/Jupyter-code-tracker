[{"block": 0, "type": "markdown", "linesLength": 1, "startIndex": 0, "lines": ["<span style=\"float:left;\">Licence CC BY-NC-ND</span><span style=\"float:right;\">Thierry Parmentelat &amp; Arnaud Legout&nbsp;<img src=\"media/inria-25-alpha.png\" style=\"display:inline\"></span><br/>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 1, "lines": ["# Premiers exemples"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 2, "lines": ["### les concepts de base en action"]}, {"block": 3, "type": "code", "linesLength": 1, "startIndex": 3, "lines": ["import asyncio"]}, {"block": 4, "type": "markdown", "linesLength": 1, "startIndex": 4, "lines": ["## coroutine"]}, {"block": 5, "type": "code", "linesLength": 12, "startIndex": 5, "lines": ["async def morceaux(message):\n", "\n", "    # on appelle le code synchrone normalement\n", "    print(message, \"d\u00e9but\")\n", "    # avec await on rend la main\n", "    await asyncio.sleep(0.5)\n", "\n", "    print(message, \"milieu\")\n", "    await asyncio.sleep(1)\n", "    \n", "    print(message, \"fin\")\n", "    return f'{message} par morceaux'"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 17, "lines": ["# objet coroutine"]}, {"block": 7, "type": "code", "linesLength": 1, "startIndex": 18, "lines": ["morceaux"]}, {"block": 8, "type": "code", "linesLength": 1, "startIndex": 19, "lines": ["morceaux(\"run\")"]}, {"block": 9, "type": "markdown", "linesLength": 1, "startIndex": 20, "lines": ["# boucle d'\u00e9v\u00e9nements"]}, {"block": 10, "type": "code", "linesLength": 1, "startIndex": 21, "lines": ["loop = asyncio.get_event_loop()"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 22, "lines": ["loop.run_until_complete(morceaux(\"run\"))"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 23, "lines": ["# plusieurs traitements"]}, {"block": 13, "type": "code", "linesLength": 3, "startIndex": 24, "lines": ["loop.run_until_complete(\n", "    asyncio.gather(morceaux(\"run1\"),\n", "                   morceaux(\"run2\")))"]}, {"block": 14, "type": "markdown", "linesLength": 1, "startIndex": 27, "lines": ["![run1-run2](w9-s2-av-fig1.png)"]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 28, "lines": ["# ce qu'il ne faut pas faire"]}, {"block": 16, "type": "code", "linesLength": 13, "startIndex": 29, "lines": ["import time \n", "\n", "async def famine(message):\n", "\n", "    print(message, \"d\u00e9but\")\n", "    # avec await on rend la main\n", "    await asyncio.sleep(0.5)\n", "\n", "    print(message, \"milieu\")\n", "    # on garde la main au lieu de la rendre\n", "    time.sleep(1)\n", "    print(message, \"fin\")\n", "    return f'{message} par famine'"]}, {"block": 17, "type": "markdown", "linesLength": 1, "startIndex": 42, "lines": ["## famine en action"]}, {"block": 18, "type": "code", "linesLength": 3, "startIndex": 43, "lines": ["loop.run_until_complete(\n", "    asyncio.gather(famine(\"run1\"),\n", "                   famine(\"run2\")))"]}, {"block": 19, "type": "markdown", "linesLength": 1, "startIndex": 46, "lines": ["# chronologie"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 47, "lines": ["![famine](w9-s2-av-fig2.png)"]}, {"block": 21, "type": "markdown", "linesLength": 1, "startIndex": 48, "lines": ["# conclusion"]}, {"block": 22, "type": "markdown", "linesLength": 1, "startIndex": 49, "lines": ["* on cr\u00e9e une coroutine avec `await def`"]}, {"block": 23, "type": "markdown", "linesLength": 2, "startIndex": 50, "lines": ["* une boucle d'\u00e9v\u00e9nements \n", "  * pour orchestrer plusieurs coroutines"]}, {"block": 24, "type": "markdown", "linesLength": 1, "startIndex": 52, "lines": ["* une coroutine peut appeler une autre coroutine avec `await`"]}, {"block": 25, "type": "markdown", "linesLength": 2, "startIndex": 53, "lines": ["* une coroutine peut appeler une fonction synchrone\n", "  * mais attention \u00e0 ne pas bloquer trop longtemps"]}]