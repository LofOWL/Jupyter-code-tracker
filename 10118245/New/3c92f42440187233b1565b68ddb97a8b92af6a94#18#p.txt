[{"block": 0, "type": "markdown", "linesLength": 5, "startIndex": 0, "lines": ["<style>div.title-slide {    width: 100%;    display: flex;    flex-direction: row;            /* default value; can be omitted */    flex-wrap: nowrap;              /* default value; can be omitted */    justify-content: space-between;}</style><div class=\"title-slide\">\n", "<span style=\"float:left;\">Licence CC BY-NC-ND</span>\n", "<span>Thierry Parmentelat &amp; Arnaud Legout</span>\n", "<span><img src=\"media/both-logos-small-alpha.png\" style=\"display:inline\" /></span>\n", "</div>"]}, {"block": 1, "type": "markdown", "linesLength": 1, "startIndex": 5, "lines": ["# La notion de package"]}, {"block": 2, "type": "markdown", "linesLength": 1, "startIndex": 6, "lines": ["## Compl\u00e9ment - niveau basique"]}, {"block": 3, "type": "markdown", "linesLength": 1, "startIndex": 7, "lines": ["Dans ce compl\u00e9ment, nous approfondissons la notion de module, qui a \u00e9t\u00e9 introduite dans les vid\u00e9os, et nous d\u00e9crivons la notion de *package* qui permet de cr\u00e9er des librairies plus structur\u00e9es qu'avec un simple module."]}, {"block": 4, "type": "markdown", "linesLength": 1, "startIndex": 8, "lines": ["Pour ce notebook nous aurons besoin de deux utilitaires pour voir le code correspondant aux modules et packages que nous manipulons:"]}, {"block": 5, "type": "code", "linesLength": 1, "startIndex": 9, "lines": ["from modtools import show_module, show_package"]}, {"block": 6, "type": "markdown", "linesLength": 1, "startIndex": 10, "lines": ["### Rappel sur les modules"]}, {"block": 7, "type": "markdown", "linesLength": 1, "startIndex": 11, "lines": ["Nous avons vu dans la vid\u00e9o qu'on peut charger une librairie, lorsqu'elle se pr\u00e9sente sous la forme d'un seul fichier source, au travers d'un objet python de type **module**. "]}, {"block": 8, "type": "markdown", "linesLength": 1, "startIndex": 12, "lines": ["Chargeons un module \"jouet\":"]}, {"block": 9, "type": "code", "linesLength": 1, "startIndex": 13, "lines": ["import module_simple"]}, {"block": 10, "type": "markdown", "linesLength": 1, "startIndex": 14, "lines": ["Voyons \u00e0 quoi ressemble ce module :"]}, {"block": 11, "type": "code", "linesLength": 1, "startIndex": 15, "lines": ["show_module(module_simple)"]}, {"block": 12, "type": "markdown", "linesLength": 1, "startIndex": 16, "lines": ["On a bien compris maintenant que le module joue le r\u00f4le d'**espace de nom**, dans le sens o\u00f9 :"]}, {"block": 13, "type": "code", "linesLength": 5, "startIndex": 17, "lines": ["# on peut d\u00e9finir sans risque un variable globale 'spam'\n", "spam = 'eggs'\n", "# qui est ind\u00e9pendante de celle d\u00e9finie dans le module\n", "print(\"spam globale\", spam)\n", "print(\"spam du module\", module_simple.spam)"]}, {"block": 14, "type": "markdown", "linesLength": 3, "startIndex": 22, "lines": ["Pour r\u00e9sumer, un module est donc un objet python qui correspond \u00e0 la fois \u00e0\n", " * un (seul) **fichier** sur le disque,\n", " * et un **espace de nom** pour les variables du programme."]}, {"block": 15, "type": "markdown", "linesLength": 1, "startIndex": 25, "lines": ["### La notion de package"]}, {"block": 16, "type": "markdown", "linesLength": 1, "startIndex": 26, "lines": ["Lorsqu'il s'agit d'impl\u00e9menter une tr\u00e8s grosse librairie, il n'est pas concevable de tout concentrer en un seul fichier. C'est l\u00e0 qu'intervient la notion de **package**, qui est un peu aux **r\u00e9pertoires** ce que que le **module** est aux **fichiers**."]}, {"block": 17, "type": "markdown", "linesLength": 1, "startIndex": 27, "lines": ["On importe un package exactement comme un module"]}, {"block": 18, "type": "code", "linesLength": 1, "startIndex": 28, "lines": ["import package_jouet"]}, {"block": 19, "type": "code", "linesLength": 1, "startIndex": 29, "lines": ["package_jouet.module_jouet"]}, {"block": 20, "type": "markdown", "linesLength": 1, "startIndex": 30, "lines": ["Le package porte **le m\u00eame nom** que le r\u00e9pertoire, c'est-\u00e0-dire que, de m\u00eame que le module `module_jouet` correspond au fichier `module_jouet.py`, le package python `package_jouet` corrrespond au r\u00e9pertoire `package_jouet`."]}, {"block": 21, "type": "markdown", "linesLength": 1, "startIndex": 31, "lines": ["Pour d\u00e9finir un package, il faut **obligatoirement** cr\u00e9er dans le r\u00e9pertoire (celui, donc, que l'on veut exposer \u00e0 python), un fichier nomm\u00e9 **`__init__.py`**. Voil\u00e0 comment a \u00e9t\u00e9 impl\u00e9ment\u00e9 le package que nous venons d'importer :"]}, {"block": 22, "type": "code", "linesLength": 1, "startIndex": 32, "lines": ["show_package(package_jouet)"]}, {"block": 23, "type": "markdown", "linesLength": 1, "startIndex": 33, "lines": ["Comme on le voit, importer un package revient essentiellement \u00e0 charger le fichier `__init__.py` correspondant. Le package se pr\u00e9sente aussi comme un espace de nom, \u00e0 pr\u00e9sent on a une troisi\u00e8me variable `spam` qui est encore diff\u00e9rente des deux autres :"]}, {"block": 24, "type": "code", "linesLength": 1, "startIndex": 34, "lines": ["package_jouet.spam"]}, {"block": 25, "type": "markdown", "linesLength": 1, "startIndex": 35, "lines": ["L'avantage principal du package par rapport au module est qu'il peut contenir d'autres packages ou modules. Dans notre cas, `package_jouet` vient avec un module qu'on peut importer comme un attribut du package, c'est-\u00e0-dire comme ceci:"]}, {"block": 26, "type": "code", "linesLength": 1, "startIndex": 36, "lines": ["import package_jouet.module_jouet"]}, {"block": 27, "type": "markdown", "linesLength": 1, "startIndex": 37, "lines": ["\u00c0 nouveau regardons comment cela est impl\u00e9ment\u00e9; le fichier correspondant au module se trouve naturellement \u00e0 l'int\u00e9rieur du r\u00e9pertoire correspondant au package, c'\u00e9tait le but du jeu au d\u00e9part :"]}, {"block": 28, "type": "code", "linesLength": 1, "startIndex": 38, "lines": ["show_module(package_jouet.module_jouet)"]}, {"block": 29, "type": "markdown", "linesLength": 1, "startIndex": 39, "lines": ["Vous remarquerez que le module `module_jouet` a \u00e9t\u00e9 charg\u00e9 au m\u00eame moment que `package_jouet`. Ce comportement **n'est pas implicite**. C'est nous qui avons explicitement choisi d'importer le module dans le package (dans `__init__.py`)."]}, {"block": 30, "type": "markdown", "linesLength": 3, "startIndex": 40, "lines": ["Cette technique correpond \u00e0 un usage assez fr\u00e9quent, o\u00f9 on veut exposer directement dans l'espace de nom du package des symboles qui sont en r\u00e9alit\u00e9 d\u00e9finis dans un module.\n", "\n", "Avec le code ci-dessus, apr\u00e8s avoir import\u00e9 `package_jouet`, nous pouvons utiliser"]}, {"block": 31, "type": "code", "linesLength": 1, "startIndex": 43, "lines": ["package_jouet.jouet"]}, {"block": 32, "type": "markdown", "linesLength": 1, "startIndex": 44, "lines": ["alors qu'en fait il faudrait \u00e9crire en toute rigueur"]}, {"block": 33, "type": "code", "linesLength": 1, "startIndex": 45, "lines": ["package_jouet.module_jouet.jouet"]}, {"block": 34, "type": "markdown", "linesLength": 4, "startIndex": 46, "lines": ["Mais cela impose alors \u00e0 l'utilisateur d'avoir une connaissance sur l'organisation interne de la librairie, ce qui est consid\u00e9r\u00e9 comme une mauvaise pratique.\n", "\n", "D\"abord, cela donne facilement des noms \u00e0 rallonge et du coup nuit \u00e0 la lisibilit\u00e9, ce n'est pas pratique.\n", "Mais surtout, que se passerait-il alors si le d\u00e9veloppeur du package voulait renommer des modules \u00e0 l'int\u00e9rieur de la librairie ? On ne veut pas que ce genre de d\u00e9cision ait un impact sur les utilisateurs."]}, {"block": 35, "type": "markdown", "linesLength": 1, "startIndex": 50, "lines": ["### \u00c0 quoi sert `__init__.py` ?"]}, {"block": 36, "type": "markdown", "linesLength": 1, "startIndex": 51, "lines": ["Le code plac\u00e9 dans `__init__.py` est charg\u00e9 d'initialiser la librairie. Le fichier **peut \u00eatre vide** mais **doit absolument exister**. Nous vous mettons en garde car c'est une erreur fr\u00e9quente de l'oublier. Sans lui vous ne pourrez importer ni le package, ni les modules ou sous-packages qu'il contient."]}, {"block": 37, "type": "markdown", "linesLength": 1, "startIndex": 52, "lines": ["C'est ce fichier qui est charg\u00e9 par l'interpr\u00e9teur python lorsque vous importez le package. Comme pour les modules, le fichier n'est charg\u00e9 qu'une seule fois par l'interpr\u00e9teur python, s'il rencontre plus tard \u00e0 nouveau le m\u00eame `import`, il l'ignore silencieusement."]}, {"block": 38, "type": "markdown", "linesLength": 1, "startIndex": 53, "lines": ["## Compl\u00e9ment - niveau avanc\u00e9"]}, {"block": 39, "type": "markdown", "linesLength": 1, "startIndex": 54, "lines": ["### Variables sp\u00e9ciales"]}, {"block": 40, "type": "markdown", "linesLength": 1, "startIndex": 55, "lines": ["Comme on le voit dans les exemples, certaines variables *sp\u00e9ciales* peuvent \u00eatre lues ou \u00e9crites dans les modules ou packages. Voici les plus utilis\u00e9es:"]}, {"block": 41, "type": "markdown", "linesLength": 1, "startIndex": 56, "lines": ["##### `__name__`"]}, {"block": 42, "type": "code", "linesLength": 1, "startIndex": 57, "lines": ["print(package_jouet.__name__, package_jouet.module_jouet.__name__)"]}, {"block": 43, "type": "markdown", "linesLength": 1, "startIndex": 58, "lines": ["Remarquons \u00e0 cet \u00e9gard que le **point d'entr\u00e9e** du programme (c'est-\u00e0-dire, on le rappelle, le fichier qui est pass\u00e9 directement \u00e0 l'interpr\u00e9teur python) est consid\u00e9r\u00e9 comme un module dont l'attribut `__name__` vaut la cha\u00eene `\"__main__\"`"]}, {"block": 44, "type": "markdown", "linesLength": 1, "startIndex": 59, "lines": ["C'est pourquoi [(et c'est \u00e9galement expliqu\u00e9 ici)](https://docs.python.org/3/tutorial/modules.html#executing-modules-as-scripts) les scripts python se terminent g\u00e9n\u00e9ralement par une phrase du genre de"]}, {"block": 45, "type": "markdown", "linesLength": 3, "startIndex": 60, "lines": ["    if __name__ == \"__main__\":\n", "        <faire vraiment quelque chose>\n", "        <comme par exemple tester le module>"]}, {"block": 46, "type": "markdown", "linesLength": 1, "startIndex": 63, "lines": ["Cet idiome tr\u00e8s r\u00e9pandu permet d'attacher du code \u00e0 un module lorsqu'on le passe directement \u00e0 l'interpr\u00e9teur python."]}, {"block": 47, "type": "markdown", "linesLength": 1, "startIndex": 64, "lines": ["##### `__file__`"]}, {"block": 48, "type": "code", "linesLength": 2, "startIndex": 65, "lines": ["print(package_jouet.__file__) \n", "print(package_jouet.module_jouet.__file__)"]}, {"block": 49, "type": "markdown", "linesLength": 1, "startIndex": 67, "lines": ["##### `__all__`"]}, {"block": 50, "type": "markdown", "linesLength": 1, "startIndex": 68, "lines": ["Il est possible de red\u00e9finir dans un package la variable `__all__`, de fa\u00e7on \u00e0 d\u00e9finir les symboles qui sont r\u00e9ellement concern\u00e9s par un `import *`, [comme c'est d\u00e9crit ici](https://docs.python.org/3/tutorial/modules.html#importing-from-a-package)."]}, {"block": 51, "type": "markdown", "linesLength": 1, "startIndex": 69, "lines": ["### Pour en savoir plus"]}, {"block": 52, "type": "markdown", "linesLength": 2, "startIndex": 70, "lines": ["Voir la [section sur les modules](https://docs.python.org/3/tutorial/modules.html) dans la documentation python, et notamment la [section sur les packages](https://docs.python.org/3/tutorial/modules.html#packages).\n", "\n"]}]